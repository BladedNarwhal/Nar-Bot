
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Store Analytics</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        :root{--primary-color:#7e69ab;--secondary-color:#9b87f5;--dark-color:#1a1f2c;--text-color:#e5deff;--success-color:#48bb78;--warning-color:#f6ad55;--danger-color:#f56565;--gray-color:#a0aec0;--glass-bg:rgba(26, 31, 44, 0.85);--glass-border:rgba(155, 135, 245, 0.4);--accent-gradient:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}*{margin:0;padding:0;box-sizing:border-box;font-family:Tajawal,Poppins,sans-serif}body{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);background-attachment:fixed;color:var(--text-color);padding:20px;min-height:100vh}.container{max-width:1200px;margin:0 auto}.header{text-align:center;margin-bottom:40px}.header h1{font-size:36px;font-weight:700;background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}.back-btn{background:var(--primary-color);color:white;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;margin-bottom:30px;text-decoration:none;display:inline-flex;align-items:center;gap:8px}.back-btn:hover{background:var(--secondary-color)}.analytics-section{background:var(--glass-bg);backdrop-filter:blur(20px);border:2px solid var(--glass-border);border-radius:25px;padding:30px;margin-bottom:30px}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin-bottom:30px}.stat-card{background:rgba(26,31,44,0.8);border:2px solid var(--glass-border);border-radius:15px;padding:25px;text-align:center}.stat-number{font-size:32px;font-weight:700;color:var(--primary-color);margin-bottom:10px}.stat-label{color:var(--gray-color);font-size:14px}.products-table{width:100%;border-collapse:collapse;margin-top:20px}.products-table th,.products-table td{padding:15px;text-align:left;border-bottom:1px solid var(--glass-border)}.products-table th{background:rgba(26,31,44,0.8);color:var(--text-color);font-weight:600}.products-table td{color:var(--gray-color)}.category-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-top:20px}.category-card{background:rgba(26,31,44,0.8);border:1px solid var(--glass-border);border-radius:10px;padding:20px}.category-name{font-weight:700;margin-bottom:10px}.category-metric{display:flex;justify-content:space-between;margin-bottom:5px;font-size:14px}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/Store" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Store
            </a>
            <h1><i class="fas fa-chart-line"></i> Store Analytics</h1>
        </div>

        <div class="analytics-section">
            <h3>Overview</h3>
            <div class="stats-grid" id="overview-stats">
                <div class="stat-card">
                    <div class="stat-number" id="total-revenue">$0</div>
                    <div class="stat-label">Total Revenue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="total-sales">0</div>
                    <div class="stat-label">Total Sales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avg-order">$0</div>
                    <div class="stat-label">Average Order</div>
                </div>
            </div>
        </div>

        <div class="analytics-section">
            <h3>Top Products</h3>
            <table class="products-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Category</th>
                        <th>Sales</th>
                        <th>Views</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody id="top-products"></tbody>
            </table>
        </div>

        <div class="analytics-section">
            <h3>Categories Performance</h3>
            <div class="category-stats" id="category-stats"></div>
        </div>

        <div class="analytics-section">
            <h3>Monthly Sales</h3>
            <div id="monthly-sales"></div>
        </div>
    </div>

    <script>
        function loadAnalytics() {
            fetch('/api/store/analytics')
                .then(response => response.json())
                .then(data => {
                    renderOverview(data);
                    renderTopProducts(data.topProducts);
                    renderCategoryStats(data.categoryStats);
                    renderMonthlySales(data.salesByMonth);
                })
                .catch(console.error);
        }

        function renderOverview(data) {
            document.getElementById('total-revenue').textContent = `$${data.totalRevenue.toFixed(2)}`;
            document.getElementById('total-sales').textContent = data.totalSales;
            const avgOrder = data.totalSales > 0 ? (data.totalRevenue / data.totalSales).toFixed(2) : '0.00';
            document.getElementById('avg-order').textContent = `$${avgOrder}`;
        }

        function renderTopProducts(products) {
            const tbody = document.getElementById('top-products');
            tbody.innerHTML = '';
            
            products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.title}</td>
                    <td>${product.category_name || 'No Category'}</td>
                    <td>${product.purchases || 0}</td>
                    <td>${product.views || 0}</td>
                    <td>$${product.price}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderCategoryStats(categories) {
            const container = document.getElementById('category-stats');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <div class="category-name">${category.name}</div>
                    <div class="category-metric">
                        <span>Products:</span>
                        <span>${category.product_count}</span>
                    </div>
                    <div class="category-metric">
                        <span>Sales:</span>
                        <span>${category.total_sales}</span>
                    </div>
                    <div class="category-metric">
                        <span>Views:</span>
                        <span>${category.total_views}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderMonthlySales(salesData) {
            const container = document.getElementById('monthly-sales');
            container.innerHTML = '';
            
            if (salesData.length === 0) {
                container.innerHTML = '<p style="text-align:center;color:var(--gray-color);">No sales data available</p>';
                return;
            }
            
            salesData.forEach(month => {
                const monthDiv = document.createElement('div');
                monthDiv.style.cssText = 'display:flex;justify-content:space-between;padding:10px;border-bottom:1px solid var(--glass-border);';
                monthDiv.innerHTML = `
                    <span>${month.month}</span>
                    <span>${month.sales} sales - $${month.revenue.toFixed(2)}</span>
                `;
                container.appendChild(monthDiv);
            });
        }

        loadAnalytics();
    </script>
</body>
</html>
