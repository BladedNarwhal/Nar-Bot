
<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Home - Community Server TovStudio</title><meta name=description content="Social Network Home"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><script src=https://cdn.socket.io/4.6.0/socket.io.min.js></script><script src=lang-config.js></script><script src=system-config.js></script><style>:root{--primary-color:#7e69ab;--primary-hover:#6b5b9a;--secondary-color:#9b87f5;--secondary-hover:#8b77f0;--dark-color:#1a1f2c;--darker-color:#151a26;--light-color:#f1f0fb;--text-color:#e5deff;--text-muted:#b8b4d1;--success-color:#48bb78;--warning-color:#f6ad55;--danger-color:#f56565;--gray-color:#a0aec0;--glass-bg:rgba(26,31,44,.85);--glass-border:rgba(155,135,245,.3);--glass-hover:rgba(155,135,245,.1);--shadow-sm:0 2px 4px rgba(0,0,0,.1);--shadow-md:0 4px 6px rgba(0,0,0,.1);--shadow-lg:0 10px 15px rgba(0,0,0,.2);--border-radius:12px;--border-radius-sm:8px;--border-radius-lg:16px;--transition:all .3s cubic-bezier(.4,0,.2,1);--transition-fast:all .2s cubic-bezier(.4,0,.2,1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Tajawal,Poppins,sans-serif}body{background:linear-gradient(135deg,var(--dark-color) 0,var(--darker-color) 100%);color:var(--text-color);min-height:100vh;overflow-x:hidden;background-size:cover;background-position:center;background-attachment:fixed}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(126,105,171,.1) 0,transparent 50%),radial-gradient(circle at 80% 20%,rgba(155,135,245,.1) 0,transparent 50%),radial-gradient(circle at 40% 80%,rgba(126,105,171,.05) 0,transparent 50%);pointer-events:none;z-index:-1}.container{display:flex;min-height:100vh;position:relative}.sidebar{width:280px;background:var(--glass-bg);backdrop-filter:blur(20px);border-right:1px solid var(--glass-border);padding:0;display:flex;flex-direction:column;transition:var(--transition);z-index:100;box-shadow:var(--shadow-lg)}.sidebar.collapsed{width:80px}.logo-container{padding:24px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--glass-border);background:linear-gradient(135deg,var(--glass-bg) 0,rgba(155,135,245,.1) 100%)}.logo{display:flex;align-items:center;transition:var(--transition)}.logo img{width:42px;height:42px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-color);transition:var(--transition)}.logo img:hover{transform:scale(1.05);border-color:var(--secondary-color)}.logo-text{font-size:18px;font-weight:700;color:var(--text-color);white-space:nowrap;transition:var(--transition)}.menu-toggle{cursor:pointer;color:var(--text-color);background:0 0;border:none;font-size:20px;padding:8px;border-radius:var(--border-radius-sm);transition:var(--transition)}.menu-toggle:hover{background:var(--glass-hover);transform:scale(1.1)}.sidebar.collapsed .logo-text{opacity:0;transform:translateX(-20px)}.menu{list-style:none;padding:20px 0;margin:0;flex:1}.menu-item{padding:16px 24px;display:flex;align-items:center;cursor:pointer;color:var(--text-muted);transition:var(--transition);position:relative;margin:4px 12px;border-radius:var(--border-radius)}.menu-item::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.menu-item.active,.menu-item:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.menu-item.active::before,.menu-item:hover::before{height:24px}.menu-item i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition);position:relative}.menu-item:hover i{transform:scale(1.1)}.menu-text{font-weight:500;transition:var(--transition)}.sidebar.collapsed .menu-text{opacity:0;transform:translateX(-20px)}.sidebar-bottom-toggle{display:none;padding:16px 24px;margin:4px 12px;cursor:pointer;color:var(--text-muted);background:transparent;border:none;border-radius:var(--border-radius);transition:var(--transition);justify-content:flex-start;align-items:center;font-size:18px;position:relative}.sidebar-bottom-toggle::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.sidebar-bottom-toggle:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.sidebar-bottom-toggle:hover::before{height:24px}.sidebar-bottom-toggle i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition)}.sidebar-bottom-toggle:hover i{transform:scale(1.1)}.sidebar.collapsed .sidebar-bottom-toggle{display:flex}.sidebar.collapsed .menu-toggle{display:none}.notification-dot{position:absolute;top:-5px;right:-5px;width:18px;height:18px;background:var(--danger-color);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:10px;font-weight:700;border:2px solid var(--dark-color);animation:pulse 2s infinite}.main-content{flex:1;padding:0;overflow-y:auto;position:relative}.header{display:flex;justify-content:space-between;align-items:center;padding:20px 32px;background:var(--glass-bg);backdrop-filter:blur(20px);border-bottom:1px solid var(--glass-border);box-shadow:var(--shadow-md);position:sticky;top:0;z-index:50}.user-info{display:flex;align-items:center;gap:12px}.user-avatar{width:40px;height:40px;border-radius:50%;border:2px solid var(--primary-color)}.user-name{font-weight:600;color:var(--text-color);display:flex;align-items:center;gap:8px}.verification-badge{width:16px;height:16px}.feed-container{max-width:720px;margin:0 auto;padding:20px}.create-post{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:28px;margin-bottom:24px;box-shadow:var(--shadow-md);position:relative;overflow:hidden}.create-post::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));border-radius:var(--border-radius-lg) var(--border-radius-lg) 0 0}.create-post-header{display:flex;align-items:center;gap:16px;margin-bottom:20px}.post-input{width:100%;background:var(--darker-color);border:1px solid var(--glass-border);border-radius:var(--border-radius);padding:20px;color:var(--text-color);font-size:16px;resize:none;min-height:120px;transition:var(--transition);font-family:inherit;line-height:1.6}.post-input:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(126,105,171,.2);background:rgba(26,31,44,.9)}.post-input::placeholder{color:var(--text-muted)}.char-counter{text-align:right;color:var(--text-muted);font-size:12px;margin-top:8px}.char-counter.warning{color:var(--warning-color)}.char-counter.error{color:var(--danger-color)}.post-actions{display:flex;justify-content:space-between;align-items:center;margin-top:20px}.media-buttons{display:flex;gap:16px}.media-btn{background:var(--glass-hover);border:1px solid var(--glass-border);border-radius:var(--border-radius);padding:12px 20px;color:var(--text-color);cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:10px;font-weight:500}.media-btn:hover{background:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-md)}.btn{padding:14px 28px;border-radius:var(--border-radius);border:none;font-weight:600;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;font-size:15px;box-shadow:var(--shadow-sm);position:relative;overflow:hidden}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:var(--transition)}.btn:hover::before{left:100%}.btn-primary{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff}.btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.posts-feed{display:flex;flex-direction:column;gap:24px}.post-card{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:0;box-shadow:var(--shadow-md);transition:var(--transition);overflow:hidden;position:relative}.post-card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));opacity:0;transition:var(--transition)}.post-card:hover{transform:translateY(-3px);box-shadow:var(--shadow-lg)}.post-card:hover::before{opacity:1}.post-header{padding:24px 28px 0;display:flex;align-items:center;gap:16px;position:relative}.post-options{position:absolute;top:20px}.post-options[dir="rtl"]{left:20px}.post-options:not([dir="rtl"]){right:20px}.post-options-btn{background:var(--glass-hover);border:1px solid var(--glass-border);border-radius:50%;width:32px;height:32px;color:var(--text-muted);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition);font-size:14px}.post-options-btn:hover{background:var(--primary-color);color:#fff;transform:scale(1.1)}.post-options-menu{position:absolute;top:100%;min-width:180px;box-shadow:var(--shadow-lg);z-index:100;opacity:0;visibility:hidden;transform:translateY(-10px);transition:var(--transition);background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius);padding:8px 0}.post-options-menu[dir="rtl"]{left:0}.post-options-menu:not([dir="rtl"]){right:0}.post-options-menu.active{opacity:1;visibility:visible;transform:translateY(0)}.post-options-item{padding:8px 16px;color:var(--text-color);cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:8px;font-size:14px}.post-options-item:hover{background:var(--glass-hover)}.post-avatar{width:52px;height:52px;border-radius:50%;border:3px solid var(--primary-color);transition:var(--transition)}.post-avatar:hover{border-color:var(--secondary-color);transform:scale(1.05)}.post-user-info{flex:1}.post-username{font-weight:600;color:var(--text-color);display:flex;align-items:center;gap:10px;font-size:16px}.post-time{color:var(--text-muted);font-size:14px;display:flex;align-items:center;gap:8px;margin-top:4px}.post-content{padding:24px 28px;color:var(--text-color);line-height:1.7;white-space:pre-wrap;font-size:15px}.post-video{width:100%;height:auto;object-fit:contain;background:#000;border-radius:0}.post-media{width:100%;height:auto;object-fit:contain;display:block}.viewer-count{position:absolute;bottom:8px;right:8px;background:rgba(0,0,0,.8);color:#fff;padding:4px 8px;border-radius:12px;font-size:12px;display:flex;align-items:center;gap:4px}.post-actions{padding:20px 28px;border-top:1px solid var(--glass-border);display:flex;align-items:center;gap:32px;background:rgba(0,0,0,.1)}.action-btn{background:0 0;border:none;color:var(--text-muted);cursor:pointer;display:flex;align-items:center;gap:10px;padding:12px 16px;border-radius:var(--border-radius);transition:var(--transition);font-size:14px;font-weight:500;position:relative}.action-btn:hover{background:var(--glass-hover);color:var(--text-color);transform:scale(1.05)}.main-reaction-btn{position:relative;overflow:visible}.main-reaction-btn .reaction-icon{transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);display:inline-block;font-size:18px}.main-reaction-btn.has-reaction .reaction-icon{color:var(--danger-color);animation:heartbeat 0.6s ease}.main-reaction-btn.clicked .reaction-icon{animation:reactionPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)}.reaction-picker{position:absolute;bottom:calc(100% + 10px);left:50%;transform:translateX(-50%);background:rgba(26,31,44,0.9);backdrop-filter:blur(25px);border:1px solid rgba(155,135,245,0.4);border-radius:20px;padding:6px 10px;display:none;gap:2px;z-index:9999;box-shadow:0 8px 25px rgba(0,0,0,0.4);opacity:0;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none;width:fit-content;min-width:170px;max-width:170px;justify-content:center;align-items:center}.reaction-picker.active{display:flex;opacity:1;pointer-events:all;animation:slideUpBounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)}.reaction-picker::before{content:'';position:absolute;bottom:-6px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid rgba(26,31,44,0.9)}.reaction-btn{background:transparent;border:none;font-size:14px;cursor:pointer;padding:4px;border-radius:50%;transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);width:26px;height:26px;display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;flex-shrink:0}.reaction-btn::before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;background:rgba(255,255,255,0.1);border-radius:50%;transition:all 0.3s ease;transform:translate(-50%, -50%)}.reaction-btn:hover{transform:scale(1.25);background:rgba(155,135,245,0.15);animation:wiggle 0.6s ease-in-out}.reaction-btn:hover::before{width:100%;height:100%}.reaction-btn:active{transform:scale(1.05);animation:heartbeat 0.6s ease}.reaction-display{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:12px;padding:0 28px}.reaction-item{display:flex;align-items:center;gap:6px;background:var(--glass-hover);padding:6px 12px;border-radius:20px;font-size:13px;transition:var(--transition);cursor:pointer;border:1px solid transparent}.reaction-item:hover{background:var(--glass-bg);border-color:var(--primary-color);transform:scale(1.05)}.reaction-item .emoji{font-size:18px;animation:float 3s ease-in-out infinite}.upload-progress{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:30px;z-index:2000;min-width:320px;text-align:center;display:none}.upload-progress h3{color:var(--text-color);margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:10px}.upload-progress .upload-icon{animation:uploadPulse 1.5s ease-in-out infinite;color:var(--primary-color)}.progress-bar{width:100%;height:8px;background:var(--darker-color);border-radius:4px;overflow:hidden;margin:20px 0;position:relative}.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));transition:width .3s ease;border-radius:4px;position:relative}.progress-fill::after{content:'';position:absolute;top:0;left:-50px;width:50px;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);animation:progressShine 1.5s ease-in-out infinite}.progress-text{color:var(--text-muted);font-size:14px;margin-top:10px}.queue-position{background:var(--warning-color);color:#fff;padding:8px 16px;border-radius:var(--border-radius);margin-top:12px;font-size:14px;font-weight:600}.likes-modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);backdrop-filter:blur(10px);z-index:1000;display:none;align-items:center;justify-content:center}.likes-modal-content{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:28px;max-width:500px;width:90%;max-height:70vh;overflow-y:auto}.likes-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.likes-modal h3{color:var(--text-color);font-size:20px}.likes-modal .close{background:0 0;border:none;color:var(--text-muted);font-size:24px;cursor:pointer;padding:8px;border-radius:50%;transition:var(--transition)}.likes-modal .close:hover{background:var(--glass-hover);color:var(--text-color)}.likes-list{display:flex;flex-direction:column;gap:16px}.like-item{display:flex;align-items:center;gap:12px;padding:12px;border-radius:var(--border-radius);transition:var(--transition)}.like-item:hover{background:var(--glass-hover)}.like-item img{width:40px;height:40px;border-radius:50%;border:2px solid var(--primary-color)}.like-item-info{flex:1}.like-item-name{color:var(--text-color);font-weight:600;display:flex;align-items:center;gap:8px}.comments-section{border-top:1px solid var(--glass-border);padding:24px 28px;background:rgba(0,0,0,.1)}.comment-form{display:flex;gap:16px;margin-bottom:24px;align-items:flex-end}.comment-input{flex:1;background:var(--darker-color);border:1px solid var(--glass-border);border-radius:24px;padding:16px 20px;color:var(--text-color);font-size:14px;resize:none;max-height:100px;transition:var(--transition);font-family:inherit}.comment-input:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 2px rgba(126,105,171,.1)}.comment-btn{background:var(--primary-color);border:none;border-radius:50%;width:48px;height:48px;color:#fff;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center}.comment-btn:hover{background:var(--primary-hover);transform:scale(1.1)}.comment{display:flex;gap:16px;margin-bottom:20px;animation:fadeInUp .4s ease-out}.comment:last-child{margin-bottom:0}.comment-avatar{width:36px;height:36px;border-radius:50%;border:2px solid var(--primary-color)}.comment-content{flex:1;background:var(--glass-bg);border-radius:20px;padding:16px 20px;position:relative}.comment-content::before{content:'';position:absolute;left:-8px;top:20px;width:0;height:0;border-top:8px solid transparent;border-bottom:8px solid transparent;border-right:8px solid var(--glass-bg)}.comment-username{font-weight:600;color:var(--text-color);font-size:14px;margin-bottom:6px;display:flex;align-items:center;gap:8px}.comment-text{color:var(--text-color);font-size:14px;line-height:1.5}.comment-time{color:var(--text-muted);font-size:12px;margin-top:8px}.comment-actions{margin-top:8px;display:flex;gap:16px}.comment-like-btn{background:0 0;border:none;color:var(--text-muted);font-size:12px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:var(--transition)}.comment-like-btn:hover{color:var(--primary-color);background:var(--glass-hover)}.comment-like-btn.liked{color:var(--danger-color)}.reply-btn{background:0 0;border:none;color:var(--text-muted);font-size:12px;cursor:pointer;padding:4px 8px;border-radius:4px;transition:var(--transition)}.reply-btn:hover{color:var(--primary-color);background:var(--glass-hover)}.replies{margin-top:16px;margin-left:20px;border-left:2px solid var(--glass-border);padding-left:20px}.reply{margin-bottom:16px}.loading{text-align:center;color:var(--text-muted);padding:40px;font-size:16px}.load-more{text-align:center;padding:24px}.load-more-comments,.load-more-replies{background:var(--glass-hover);border:1px solid var(--glass-border);color:var(--text-color);padding:8px 16px;border-radius:var(--border-radius);cursor:pointer;transition:var(--transition);font-size:13px;margin:12px 0}.load-more-comments:hover,.load-more-replies:hover{background:var(--primary-color);color:#fff}.media-preview{position:relative;margin-top:16px;border-radius:var(--border-radius);overflow:hidden}.media-preview img,.media-preview video{width:100%;max-height:300px;object-fit:contain;border-radius:var(--border-radius)}.remove-media{position:absolute;top:12px;right:12px;background:rgba(0,0,0,.8);border:none;border-radius:50%;width:32px;height:32px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:var(--transition)}.remove-media:hover{background:var(--danger-color);transform:scale(1.1)}.fullscreen-video{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:9999;display:flex;align-items:center;justify-content:center}.fullscreen-video video{width:100%;height:100%;object-fit:contain}.fullscreen-controls{position:absolute;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px;background:rgba(0,0,0,.8);padding:10px 20px;border-radius:25px}.fullscreen-controls button{background:0 0;border:none;color:#fff;cursor:pointer;padding:8px 12px;border-radius:6px;transition:var(--transition)}.fullscreen-controls button:hover{background:rgba(255,255,255,.2)}.hidden{display:none!important}.toast{position:fixed;top:24px;right:24px;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:20px 28px;color:var(--text-color);box-shadow:var(--shadow-lg);z-index:1000;opacity:0;transform:translateX(100%);animation:slideInRight .4s ease-out forwards;max-width:400px}.toast.success{border-left:4px solid var(--success-color)}.toast.error{border-left:4px solid var(--danger-color)}.toast.warning{border-left:4px solid var(--warning-color)}.toast.removing{animation:slideOutRight .4s ease-out forwards}#file-input{display:none}.spinner{border:3px solid var(--glass-border);border-top:3px solid var(--primary-color);border-radius:50%;width:20px;height:20px;animation:spin 1s linear infinite;margin:0 auto}.new-post-indicator{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:var(--primary-color);color:#fff;padding:12px 24px;border-radius:25px;box-shadow:var(--shadow-lg);z-index:1000;cursor:pointer;transition:var(--transition);opacity:0;transform:translateX(-50%) translateY(-20px);animation:slideInDown 0.4s ease-out forwards}.new-post-indicator:hover{background:var(--primary-hover);transform:translateX(-50%) translateY(-2px)}.user-activity-indicator{position:fixed;bottom:20px;right:20px;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:16px 20px;color:var(--text-color);font-size:14px;z-index:1000;opacity:0;transform:translateY(20px);transition:var(--transition);display:none}.user-activity-indicator.active{opacity:1;transform:translateY(0);display:block}@media (max-width:768px){.container{flex-direction:column}.sidebar{width:100%;border-right:none;border-bottom:1px solid var(--glass-border);position:relative}.sidebar.collapsed{width:100%}.header{padding:16px}.feed-container{padding:12px}.post-card{margin:0 -8px}.comments-section,.post-actions,.post-content,.post-header{padding-left:20px;padding-right:20px}.reaction-picker{min-width:150px;max-width:150px;padding:4px 6px;gap:1px}.reaction-btn{width:22px;height:22px;font-size:12px;padding:3px}}@media (max-width:480px){.reaction-picker{min-width:140px;max-width:140px;padding:3px 5px;gap:1px}.reaction-btn{width:20px;height:20px;font-size:11px;padding:2px}}@keyframes slideInDown{0%{opacity:0;transform:translateX(-50%) translateY(-20px)}100%{opacity:1;transform:translateX(-50%) translateY(0)}}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes uploadPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes progressShine{0%{left:-50px}100%{left:100%}}@keyframes slideUpBounce{0%{opacity:0;transform:translateX(-50%) translateY(20px) scale(0.8)}50%{opacity:1;transform:translateX(-50%) translateY(-5px) scale(1.1)}100%{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}@keyframes wiggle{0%,100%{transform:scale(1.25) rotate(0deg)}25%{transform:scale(1.35) rotate(-2deg)}50%{transform:scale(1.45) rotate(2deg)}75%{transform:scale(1.35) rotate(-2deg)}}@keyframes heartbeat{0%,100%{transform:scale(1)}25%{transform:scale(1.1)}50%{transform:scale(1.2)}75%{transform:scale(1.1)}}@keyframes reactionPop{0%{transform:scale(1)}50%{transform:scale(1.3) rotate(5deg)}100%{transform:scale(1) rotate(0deg)}}@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-3px)}}@keyframes slideInRight{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}@keyframes slideOutRight{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@media (max-width:1024px){.feed-container{padding:16px;max-width:100%}.main-content{padding:0}}</style></head><body><div class=container><div class=sidebar><div class=logo-container><div class=logo><img src="" id=logo-img alt=Logo><div class=logo-text data-lang-key=sidebar.title>Social Network</div></div><button class=menu-toggle id=toggle-sidebar><i class="fas fa-bars"></i></button></div><ul class=menu><li class="menu-item active" onclick='window.location.href="/Home"'><i class="fas fa-home"><span class="notification-dot hidden" id=home-notification>0</span></i><span class=menu-text data-lang-key=sidebar.home>Home</span></li><li class=menu-item onclick='window.location.href="/"'><i class="fas fa-chart-bar"></i><span class=menu-text data-lang-key=sidebar.dashboard>Dashboard</span></li><li class=menu-item onclick='window.location.href="/Tickets"'><i class="fas fa-ticket"></i><span class=menu-text data-lang-key=sidebar.tickets>Tickets</span></li><li class=menu-item onclick='window.location.href="/Users"'><i class="fas fa-users"></i><span class=menu-text data-lang-key=sidebar.users>Users</span></li><li class=menu-item onclick='window.location.href="/Ratings"'><i class="fas fa-star"></i><span class=menu-text data-lang-key=sidebar.ratings>Ratings</span></li><li class=menu-item onclick='window.location.href="/Store"'><i class="fas fa-store"></i><span class=menu-text data-lang-key=sidebar.store>Store</span></li><li class=menu-item onclick='window.location.href="/Settings"'><i class="fas fa-cog"></i><span class=menu-text data-lang-key=sidebar.settings>Settings</span></li><li class=menu-item id=logout-btn><i class="fas fa-sign-out-alt"></i><span class=menu-text data-lang-key=sidebar.logout>Logout</span></li></ul><button class="sidebar-bottom-toggle" id="bottom-toggle-sidebar"><i class="fas fa-bars"></i></button></div><div class=main-content><div class=header><div class=user-info id=user-info style=display:none><img class=user-avatar id=user-avatar src="" alt=Avatar><div class=user-name id=user-name><span id=username></span><img class="verification-badge hidden" id=verification-badge src="" alt=Verified></div></div><button class="btn btn-primary" id=login-btn><i class="fas fa-sign-in-alt"></i> <span data-lang-key=header.login>Login</span></button></div><div class=feed-container id=feed-container style=display:none><div class=create-post><div class=create-post-header><img class=user-avatar id=create-post-avatar src="" alt=Avatar><div><div style=font-weight:600;color:var(--text-color);font-size:16px data-lang-key=home.createPost.title>Create a new post</div><div style=font-size:14px;color:var(--text-muted) data-lang-key=home.createPost.subtitle>Share your thoughts with the community</div></div></div><textarea class=post-input id=post-content data-lang-placeholder=home.createPost.placeholder maxlength=100></textarea><div class=char-counter id=char-counter>0/100</div><div class="media-preview hidden" id=media-preview><img id=preview-image class=hidden alt=Preview><video id=preview-video class=hidden controls preload=metadata></video><button class=remove-media id=remove-media><i class="fas fa-times"></i></button></div><div class=post-actions><div class=media-buttons><button class=media-btn id=image-btn><i class="fas fa-image"></i> <span data-lang-key=home.createPost.photo>Photo</span></button><button class=media-btn id=video-btn><i class="fas fa-video"></i> <span data-lang-key=home.createPost.video>Video</span></button><button class=media-btn id=gif-btn><i class="fas fa-laugh"></i> <span data-lang-key=home.createPost.gif>GIF</span></button></div><button class="btn btn-primary" id=post-btn><span data-lang-key=home.createPost.sharePost>Share Post</span></button></div></div><div class=posts-feed id=posts-feed></div><div class=load-more><button class="btn btn-primary" id=load-more-btn data-lang-key=home.posts.loadMore>Load More Posts</button></div></div><div class=loading id=loading><div class=spinner></div><div data-lang-key=home.posts.loading>Loading amazing content...</div></div></div></div><div class=upload-progress id=upload-progress><h3><i class="fas fa-cloud-upload-alt upload-icon"></i> <span data-lang-key=home.media.uploading>Uploading Media</span></h3><div class=progress-bar><div class=progress-fill id=progress-fill style=width:0%></div></div><div class=progress-text id=progress-text data-lang-key=home.media.preparing>Preparing upload...</div><div class="queue-position hidden" id=queue-position>You are #1 in upload queue</div></div><div class=likes-modal id=likes-modal><div class=likes-modal-content><div class=likes-modal-header><h3 data-lang-key=home.posts.viewReactions>People who reacted</h3><button class=close onclick=closeLikesModal()><i class="fas fa-times"></i></button></div><div class=likes-list id=likes-list></div></div></div><div class="user-activity-indicator" id=user-activity-indicator></div><input type=file id=file-input accept=image/*,video/*,.gif style=display:none><audio id=notification-sound></audio><audio id=message-sound></audio><script>let currentUser=null,posts=[],currentPage=0,isLoading=!1,socket=null,notificationCount=0,selectedMedia=null,mediaType=null,activeCommentsSection=null,isUploading=!1,commentsData={},postReactions={},reactionPickerTimeout={},activeReactionPicker=null,pendingPosts=[],updateTimeout=null,isPageVisible=!0,isInitialLoad=!0,hasMorePosts=!0,uploadQueue=[],maxConcurrentUploads=window.getHomeConfig?window.getHomeConfig('limits.maxConcurrentUploads',2):2,activeUploads=0;const MAX_VIDEO_SIZE=window.getHomeConfig?window.getHomeConfig('limits.maxVideoSize',10485760):10485760,MAX_VIDEO_DURATION=window.getHomeConfig?window.getHomeConfig('limits.maxVideoTime',300):300,MAX_GIF_SIZE=window.getHomeConfig?window.getHomeConfig('limits.maxGifSize',3145728):3145728;let userState={savedInputs:{},isInteracting:!1,activeComments:new Set,lastInteraction:Date.now()},updateQueue=[],isProcessingQueue=!1,smartUpdateSystem={isUserActive:()=>Date.now()-userState.lastInteraction<5e3||userState.isInteracting||"TEXTAREA"===document.activeElement.tagName||"INPUT"===document.activeElement.tagName,queueUpdate:(e,t=1)=>{isInitialLoad?e():(updateQueue.push({fn:e,priority:t,timestamp:Date.now()}),updateQueue.sort((e,t)=>t.priority-e.priority),isProcessingQueue||smartUpdateSystem.processQueue())},processQueue:()=>{if(isProcessingQueue||0===updateQueue.length)return;isProcessingQueue=!0;const e=()=>{if(0===updateQueue.length)return void(isProcessingQueue=!1);if(smartUpdateSystem.isUserActive())return void setTimeout(e,2e3);const t=updateQueue.shift();try{t.fn(),setTimeout(e,200)}catch(t){console.error("Update error:",t),setTimeout(e,100)}};e()},saveUserInput:(e,t)=>{userState.savedInputs[e]=t},restoreUserInput:e=>{const t=document.getElementById(e);t&&void 0!==userState.savedInputs[e]&&(t.value=userState.savedInputs[e])},preserveCommentStates:()=>{document.querySelectorAll(".comment-input").forEach(e=>{if(e.value.trim()){const t=e.closest(".comments-section").id.replace("comments-","");smartUpdateSystem.saveUserInput(`comment-${t}`,e.value)}})},restoreCommentStates:()=>{document.querySelectorAll(".comment-input").forEach(e=>{const t=e.closest(".comments-section").id.replace("comments-","");smartUpdateSystem.restoreUserInput(`comment-${t}`)})},addPostSmoothly:e=>{const t=createPostElement(e);t.style.opacity="0",t.style.transform="translateY(-20px)",postsFeed.insertBefore(t,postsFeed.firstChild),setTimeout(()=>{t.style.transition="all 0.5s ease-out",t.style.opacity="1",t.style.transform="translateY(0)"},100)},updatePostInPlace:(e,t)=>{const o=document.querySelector(`[data-post-id="${e}"]`);if(o){const e=o.querySelector(".main-reaction-btn span"),n=o.querySelector(".action-btn:nth-child(2) span");e&&void 0!==t.reactions_count&&(e.textContent=t.reactions_count),n&&void 0!==t.comments_count&&(n.textContent=t.comments_count)}}};const sidebar=document.querySelector(".sidebar"),toggleSidebarBtn=document.getElementById("toggle-sidebar"),bottomToggleBtn=document.getElementById("bottom-toggle-sidebar"),loginBtn=document.getElementById("login-btn"),logoutBtn=document.getElementById("logout-btn"),feedContainer=document.getElementById("feed-container"),loading=document.getElementById("loading"),postsFeed=document.getElementById("posts-feed"),postContent=document.getElementById("post-content"),postBtn=document.getElementById("post-btn"),loadMoreBtn=document.getElementById("load-more-btn"),fileInput=document.getElementById("file-input"),mediaPreview=document.getElementById("media-preview"),previewImage=document.getElementById("preview-image"),previewVideo=document.getElementById("preview-video"),removeMediaBtn=document.getElementById("remove-media"),notificationSound=document.getElementById("notification-sound"),messageSound=document.getElementById("message-sound"),homeNotification=document.getElementById("home-notification"),charCounter=document.getElementById("char-counter"),likesModal=document.getElementById("likes-modal"),likesList=document.getElementById("likes-list"),uploadProgressEl=document.getElementById("upload-progress"),progressFill=document.getElementById("progress-fill"),progressText=document.getElementById("progress-text"),queuePosition=document.getElementById("queue-position"),userActivityIndicator=document.getElementById("user-activity-indicator");function loadSidebarState(){const e=localStorage.getItem("sidebarCollapsed");return"true"===e}function saveSidebarState(e){localStorage.setItem("sidebarCollapsed",e.toString())}function toggleSidebar(){sidebar.classList.toggle("collapsed");const e=sidebar.classList.contains("collapsed");saveSidebarState(e)}function debounce(e,t){let o;return function(...n){clearTimeout(o),o=setTimeout(()=>e(...n),t)}}function trackUserInteraction(){userState.lastInteraction=Date.now(),userState.isInteracting=!0,clearTimeout(userState.interactionTimeout),userState.interactionTimeout=setTimeout(()=>{userState.isInteracting=!1},3e3)}function showUserActivity(e,t=3e3){userActivityIndicator.textContent=e,userActivityIndicator.classList.add("active"),setTimeout(()=>{userActivityIndicator.classList.remove("active")},t)}function showToast(e,t="info"){const o=document.createElement("div");o.className=`toast ${t}`,o.innerHTML=`<div><strong>${"success"===t?"‚úì":"error"===t?"‚úó":"‚Ñπ"}</strong> ${e}</div>`,document.body.appendChild(o),setTimeout(()=>{o.classList.add("removing"),setTimeout(()=>o.remove(),400)},window.getHomeConfig?window.getHomeConfig("notifications.toastDuration",4e3):4e3)}function playSound(e){const t=window.getHomeConfig?window.getHomeConfig("notifications.playNotificationSound",!0):!0,o=window.getHomeConfig?window.getHomeConfig("notifications.playMessageSound",!0):!0;"notification"===e&&t?notificationSound.play().catch(()=>{}):"message"===e&&o&&messageSound.play().catch(()=>{})}function updateNotificationCount(e){notificationCount+=e,homeNotification.textContent=notificationCount,notificationCount>0?homeNotification.classList.remove("hidden"):homeNotification.classList.add("hidden")}function updateCharCounter(){const e=postContent.value.length,t=(window.getHomeConfig?window.getHomeConfig("limits.maxPostLength",100):100)-e;charCounter.textContent=`${t} ${window.langConfig?.getText("home.createPost.charCounter")||"characters remaining"}`,charCounter.className="char-counter",e>80?charCounter.classList.add("warning"):e>=100&&charCounter.classList.add("error")}function validateMedia(e){if(e.type.startsWith("video/")){if(e.size>MAX_VIDEO_SIZE)return showToast(`Video file is too large. Maximum size is ${MAX_VIDEO_SIZE/1024/1024}MB`,"error"),!1;const t=document.createElement("video");return t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{t.duration>MAX_VIDEO_DURATION&&(showToast(`Video is too long. Maximum duration is ${MAX_VIDEO_DURATION/60} minutes`,"error"),URL.revokeObjectURL(t.src)),URL.revokeObjectURL(t.src)},!0}return!e.type.includes("gif")&&!e.name.toLowerCase().endsWith(".gif")||(!(e.size>MAX_GIF_SIZE)||(showToast(`GIF file is too large. Maximum size is ${MAX_GIF_SIZE/1024/1024}MB`,"error"),!1))}function addToUploadQueue(e){uploadQueue.push({...e,id:Date.now(),status:"queued"}),updateQueueDisplay(),processUploadQueue()}function processUploadQueue(){if(activeUploads>=maxConcurrentUploads||0===uploadQueue.length)return;const e=uploadQueue.find(e=>"queued"===e.status);e&&(e.status="processing",activeUploads++,executeUpload(e))}function executeUpload(e){showUploadProgress(0,`Processing upload... (${activeUploads}/${maxConcurrentUploads} active)`),e.callback().then(()=>{completeUpload(e.id)}).catch(t=>{failUpload(e.id,t)})}function completeUpload(e){activeUploads--,uploadQueue=uploadQueue.filter(t=>t.id!==e),updateQueueDisplay(),processUploadQueue()}function failUpload(e,t){activeUploads--,uploadQueue=uploadQueue.filter(t=>t.id!==e),showToast("Upload failed: "+t.message,"error"),updateQueueDisplay(),processUploadQueue()}function updateQueueDisplay(){const e=uploadQueue.filter(e=>"queued"===e.status);e.length>0?(queuePosition.textContent=`You are #${e.length} in upload queue`,queuePosition.classList.remove("hidden")):queuePosition.classList.add("hidden")}function showUploadProgress(e=0,t="Preparing upload..."){uploadProgressEl.style.display="block",progressFill.style.width=`${e}%`,progressText.textContent=window.langConfig?.getText(t)||t}function hideUploadProgress(){uploadProgressEl.style.display="none",progressFill.style.width="0%",progressText.textContent=window.langConfig?.getText("home.media.preparing")||"Preparing upload...",queuePosition.classList.add("hidden")}function simulateUploadProgress(){let e=0;const t=setInterval(()=>{if(e+=15*Math.random(),e>=95&&(e=95,clearInterval(t)),progressFill.style.width=`${e}%`,e<30)progressText.textContent=window.langConfig?.getText("home.media.processing")||"Processing...";else if(e<60)progressText.textContent=window.langConfig?.getText("home.media.optimizing")||"Optimizing...";else if(e<90)progressText.textContent=window.langConfig?.getText("home.media.uploading")||"Uploading...";else progressText.textContent=window.langConfig?.getText("home.media.finalizing")||"Finalizing..."},200);return t}function showNewPostsIndicator(){if(pendingPosts.length>0){const e=document.querySelector(".new-post-indicator");e&&e.remove();const t=document.createElement("div");t.className="new-post-indicator",t.innerHTML=`<i class="fas fa-arrow-up"></i> ${pendingPosts.length} new post${pendingPosts.length>1?"s":""}`,t.onclick=()=>{smartUpdateSystem.preserveCommentStates(),posts.unshift(...pendingPosts),pendingPosts=[],t.remove(),smartUpdateSystem.queueUpdate(()=>{renderPosts(),smartUpdateSystem.restoreCommentStates()},3)},document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.remove()},window.getHomeConfig?window.getHomeConfig("notifications.newPostIndicatorTimeout",1e4):1e4)}}function initializeSocket(){socket=io(),socket.on("new_post",e=>{e.user_id!==currentUser.id&&(smartUpdateSystem.isUserActive()?(pendingPosts.unshift(e),showNewPostsIndicator(),showUserActivity(`New post from ${e.username}`)):smartUpdateSystem.queueUpdate(()=>{smartUpdateSystem.addPostSmoothly(e),posts.unshift(e)},2),updateNotificationCount(1),showToast(`${window.langConfig?.getText("home.posts.newPost")||"New post from"} ${e.username}`,"success"),playSound("notification"))}),socket.on("new_comment",e=>{const t=posts.find(t=>t.id===e.post_id);t&&(t.comments_count++,smartUpdateSystem.updatePostInPlace(e.post_id,{comments_count:t.comments_count}),e.comment.user_id!==currentUser.id&&(updateNotificationCount(1),showToast(window.langConfig?.getText("home.posts.newComment")||"New comment","info"),playSound("message")))}),socket.on("post_reaction_update",e=>{const t=posts.find(t=>t.id===e.post_id);t&&(t.reactions=e.reactions,t.reactions_count=e.reactions_count,e.user_id===currentUser.id&&(t.user_reaction=e.user_reaction),smartUpdateSystem.queueUpdate(()=>{updatePostReactionButton(e.post_id,e.user_reaction,e.reactions_count)},1),e.user_id!==currentUser.id&&playSound("message"))}),socket.on("post_view_update",e=>{const t=posts.find(t=>t.id===e.post_id);t&&(t.views_count=e.views_count,smartUpdateSystem.queueUpdate(()=>{updateViewCounter(e.post_id,e.views_count)},0))})}function updatePostReactionButton(e,t,o){const n=document.querySelector(`[data-post-id="${e}"] .main-reaction-btn`);if(n){const e=n.querySelector(".reaction-icon"),a=n.querySelector("span"),s=getEmojiForReaction(t);n.classList.toggle("has-reaction",!!t),t?(e.innerHTML=s,e.style.color="var(--danger-color)"):(e.innerHTML='<i class="fas fa-heart"></i>',e.style.color=""),a.textContent=o||0,n.classList.add("clicked"),setTimeout(()=>n.classList.remove("clicked"),600)}}function getEmojiForReaction(e){if(window.getHomeConfig){const t=window.getHomeConfig("reactions.emojis",{like:"üëç",love:"‚ù§Ô∏è",laugh:"üòÇ",angry:"üò°",sad:"üò¢",wow:"üòÆ"});return t[e]||'<i class="fas fa-heart"></i>'}return{like:"üëç",love:"‚ù§Ô∏è",laugh:"üòÇ",angry:"üò°",sad:"üò¢",wow:"üòÆ"}[e]||'<i class="fas fa-heart"></i>'}function updateViewCounter(e,t){const o=document.getElementById(`views-${e}`);o&&(o.innerHTML=`<i class="fas fa-eye"></i> ${t}`)}function checkAuth(){fetch("/api/auth/status").then(e=>e.json()).then(e=>{e.authenticated?(currentUser=e.user,handleSuccessfulLogin()):window.location.href="/auth/discord"}).catch(e=>{console.error("Error checking auth:",e),window.location.href="/auth/discord"})}function handleSuccessfulLogin(){document.getElementById("user-avatar").src=currentUser.avatar?`https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png`:"/placeholder.svg",document.getElementById("create-post-avatar").src=currentUser.avatar?`https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png`:"/placeholder.svg",document.getElementById("username").textContent=currentUser.global_name||currentUser.username,currentUser.verified&&(document.getElementById("verification-badge").src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Twitter_Verified_Badge.svg/2048px-Twitter_Verified_Badge.svg.png",document.getElementById("verification-badge").classList.remove("hidden")),document.getElementById("user-info").style.display="flex",loginBtn.style.display="none",feedContainer.style.display="block",loading.style.display="none",loadPosts(),initializeSocket(),loadNotifications()}async function loadPosts(e=!1){if(isLoading)return;isLoading=!0,loadMoreBtn.disabled=!0,loadMoreBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Loading...';try{const t=await fetch(`/api/posts?page=${currentPage}`),o=await t.json(),n=o.posts||o;hasMorePosts=!1!==o.has_more&&n.length>0,e?posts=[...posts,...n]:(posts=n,currentPage=0),renderPosts(),currentPage++,hasMorePosts?loadMoreBtn.style.display="block":loadMoreBtn.style.display="none"}catch(e){console.error("Error loading posts:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}finally{isLoading=!1,loadMoreBtn.disabled=!1,loadMoreBtn.innerHTML=window.langConfig?.getText("home.posts.loadMore")||"Load More Posts"}}async function loadNotifications(){try{const e=await fetch("/api/notifications");updateNotificationCount((await e.json()).filter(e=>!e.read).length)}catch(e){console.error("Error loading notifications:",e)}}function renderPosts(){smartUpdateSystem.preserveCommentStates(),postsFeed.innerHTML="",posts.forEach(e=>{const t=createPostElement(e);postsFeed.appendChild(t)}),smartUpdateSystem.restoreCommentStates()}function createPostElement(e){const t=document.createElement("div");t.className="post-card",t.setAttribute("data-post-id",e.id);let o="";if(e.media_path)if("video"===e.media_type)o=`<div style="position:relative;width:100%;background:#000;margin:0;padding:0;"><video class="post-video" controls preload="metadata" onloadstart="updatePostViews('${e.id}')"><source src="/data/videos/${e.media_path}" type="video/mp4">Your browser does not support the video tag.</video><div class="viewer-count" id="views-${e.id}"><i class="fas fa-eye"></i> ${e.views_count||0}</div></div>`;else if("image"===e.media_type||"gif"===e.media_type)o=`<div style="position:relative;width:100%;background:#000;margin:0;padding:0;"><img class="post-media" src="/data/images/${e.media_path}" alt="Post media" onload="updatePostViews('${e.id}')"><div class="viewer-count" id="views-${e.id}"><i class="fas fa-eye"></i> ${e.views_count||0}</div></div>`;const n=e.reactions||{},a=Object.keys(n).map(e=>{const t=getEmojiForReaction(e);return`<div class="reaction-item" onclick="filterReactions('${e}')"><span class="emoji">${t}</span><span>${n[e]}</span></div>`}).join(""),s=getEmojiForReaction(e.user_reaction),c="rtl"===document.documentElement.dir;return t.innerHTML=`<div class="post-header"><img class="post-avatar" src="${e.avatar_url||"/placeholder.svg"}" alt="${e.username}"><div class="post-user-info"><div class="post-username">${e.global_name||e.username}${e.verification_badge?`<img class="verification-badge" src="${e.verification_badge}" alt="Verified">`:""}</div><div class="post-time"><i class="fas fa-clock"></i>${new Date(1e3*e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div></div><div class="post-options" ${c?'dir="rtl"':""}><button class="post-options-btn" onclick="togglePostOptions('${e.id}')"><i class="fas fa-ellipsis-h"></i></button><div class="post-options-menu" ${c?'dir="rtl"':""} id="post-options-${e.id}"><div class="post-options-item" onclick="showReactions('${e.id}'); closePostOptions('${e.id}')"><i class="fas fa-heart"></i> <span data-lang-key="home.posts.viewReactions">View Reactions</span></div>${e.user_id===currentUser.id||"admin"===currentUser.id?`<div class="post-options-item" onclick="deletePost('${e.id}'); closePostOptions('${e.id}')"><i class="fas fa-trash"></i> <span data-lang-key="home.posts.deletePost">Delete Post</span></div>`:""}</div></div></div>${e.content?`<div class="post-content">${e.content}</div>`:""}${o}<div class="post-actions"><div class="action-btn main-reaction-btn ${e.user_reaction?"has-reaction":""}" onmouseenter="showReactionPicker('${e.id}')" onmouseleave="hideReactionPicker('${e.id}')" onclick="quickReaction('${e.id}', 'like')"><span class="reaction-icon">${e.user_reaction?s:'<i class="fas fa-heart"></i>'}</span><span>${e.reactions_count||0}</span><div class="reaction-picker" id="reaction-picker-${e.id}"><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'like')">üëç</button><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'love')">‚ù§Ô∏è</button><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'laugh')">üòÇ</button><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'angry')">üò°</button><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'sad')">üò¢</button><button class="reaction-btn" onclick="event.stopPropagation(); addReaction('${e.id}', 'wow')">üòÆ</button></div></div><button class="action-btn" onclick="toggleComments('${e.id}')"><i class="fas fa-comment"></i><span>${e.comments_count}</span></button></div>${a?`<div class="reaction-display">${a}</div>`:""}<div class="comments-section hidden" id="comments-${e.id}"><div class="comment-form"><img class="comment-avatar" src="${currentUser.avatar?`https://cdn.discordapp.com/avatars/${currentUser.id}/${currentUser.avatar}.png`:"/placeholder.svg"}" alt="Your avatar"><textarea class="comment-input" id="comment-${e.id}" data-lang-placeholder="home.comments.writeComment" maxlength="${window.getHomeConfig?window.getHomeConfig("limits.maxCommentLength",150):150}" onkeypress="handleCommentKeypress(event, '${e.id}')" oninput="updateCommentLength(this);smartUpdateSystem.saveUserInput('comment-${e.id}',this.value)"></textarea><button class="comment-btn" onclick="postComment('${e.id}')"><i class="fas fa-paper-plane"></i></button></div><div class="comments-list" id="comments-list-${e.id}"></div></div>`,t}function showReactionPicker(e){hideAllReactionPickers(),clearTimeout(reactionPickerTimeout[e]);const t=document.getElementById(`reaction-picker-${e}`);t&&!t.classList.contains("active")&&(activeReactionPicker=e,t.classList.add("active"),t.style.pointerEvents="all",playSound("message"))}function hideReactionPicker(e){const t=window.getHomeConfig?window.getHomeConfig("reactions.pickerHoverDelay",300):300;reactionPickerTimeout[e]=setTimeout(()=>{const t=document.getElementById(`reaction-picker-${e}`);t&&activeReactionPicker===e&&(t.classList.remove("active"),t.style.pointerEvents="none",activeReactionPicker=null)},t)}function hideAllReactionPickers(){document.querySelectorAll(".reaction-picker").forEach(e=>{e.classList.remove("active"),e.style.pointerEvents="none"}),activeReactionPicker=null}async function addReaction(e,t){hideReactionPicker(e);try{const o=await fetch(`/api/posts/${e}/reaction`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reaction:t})}),n=await o.json();updatePostReactionButton(e,n.user_reaction,n.reactions_count);const a=posts.find(t=>t.id===e);a&&(a.reactions=n.reactions,a.user_reaction=n.user_reaction,a.reactions_count=n.reactions_count,smartUpdateSystem.queueUpdate(()=>{const t=document.querySelector(`[data-post-id="${e}"]`);if(t){const e=t.querySelector(".reaction-display");if(e){const t=n.reactions||{},o=Object.keys(t).map(e=>{const o=getEmojiForReaction(e);return`<div class="reaction-item" onclick="filterReactions('${e}')"><span class="emoji">${o}</span><span>${t[e]}</span></div>`}).join("");e.innerHTML=o}}},1)),playSound("message")}catch(e){console.error("Error adding reaction:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}async function quickReaction(e,t){const o=document.getElementById(`reaction-picker-${e}`);if(o&&o.classList.contains("active"))return;const n=posts.find(t=>t.id===e);n&&n.user_reaction===t?addReaction(e,t):addReaction(e,t)}async function deletePost(e){if(confirm(window.langConfig?.getText("home.messages.deleteConfirm")||"Are you sure you want to delete this post?"))try{(await fetch(`/api/posts/${e}`,{method:"DELETE"})).ok?(posts=posts.filter(t=>t.id!==e),smartUpdateSystem.queueUpdate(renderPosts,3),showToast(window.langConfig?.getText("home.messages.deleteSuccess")||"Post deleted successfully","success")):showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}catch(e){console.error("Error deleting post:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}function togglePostOptions(e){const t=document.getElementById(`post-options-${e}`);document.querySelectorAll(".post-options-menu").forEach(e=>e.classList.remove("active")),t.classList.toggle("active")}function closePostOptions(e){const t=document.getElementById(`post-options-${e}`);t&&t.classList.remove("active")}function updateCommentLength(e){const t=e.value.length;let o=e.parentElement.querySelector(".char-counter");o||(o=document.createElement("div"),o.className="char-counter",e.parentElement.appendChild(o));const n=window.getHomeConfig?window.getHomeConfig("limits.maxCommentLength",150):150;o.textContent=`${t}/${n}`,o.className="char-counter",t>120?o.classList.add("warning"):t>=n&&o.classList.add("error")}let viewedPosts=new Set;async function updatePostViews(e){if(!viewedPosts.has(e)){viewedPosts.add(e);try{await fetch(`/api/posts/${e}/view`,{method:"POST"})}catch(e){console.error("Error updating post views:",e)}}}function enterFullscreen(e){const t=document.getElementById(`video-${e}`),o=document.createElement("div");o.className="fullscreen-video",o.innerHTML=`<video controls autoplay><source src="${t.querySelector("source").src}" type="video/mp4"></video><div class="fullscreen-controls"><button onclick="exitFullscreen()"><i class="fas fa-compress"></i> Exit Fullscreen</button></div>`,document.body.appendChild(o)}function exitFullscreen(){const e=document.querySelector(".fullscreen-video");e&&e.remove()}async function showReactions(e){try{const t=await fetch(`/api/posts/${e}/reactions`),o=await t.json();if(likesList.innerHTML="",o.length>0)o.forEach(e=>{const t=document.createElement("div");t.className="like-item";const o=getEmojiForReaction(e.reaction);t.innerHTML=`<img src="${e.avatar_url||"/placeholder.svg"}" alt="${e.username}"><div class="like-item-info"><div class="like-item-name">${e.global_name||e.username}${e.verification_badge?`<img class="verification-badge" src="${e.verification_badge}" alt="Verified" style="width:12px;height:12px;">`:""}</div><div style="font-size:12px;color:var(--text-muted)">${o} ${e.reaction}</div></div>`,likesList.appendChild(t)});else likesList.innerHTML=`<div style="text-align:center;color:var(--text-muted);padding:20px;">${window.langConfig?.getText("home.posts.noReactions")||"No reactions yet"}</div>`;likesModal.style.display="flex"}catch(e){console.error("Error loading reactions:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}function closeLikesModal(){likesModal.style.display="none"}function filterReactions(e){showToast(`Showing ${e} reactions`,"info")}async function toggleComments(e){const t=document.getElementById(`comments-${e}`);if(t.classList.contains("hidden")){t.classList.remove("hidden"),activeCommentsSection=e,userState.activeComments.add(e);try{await loadCommentsForPost(e)}catch(e){console.error("Error loading comments:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}else t.classList.add("hidden"),activeCommentsSection=null,userState.activeComments.delete(e)}async function loadCommentsForPost(e,t=0){try{const o=await fetch(`/api/posts/${e}/comments?page=${t}`),n=await o.json(),a=document.getElementById(`comments-list-${e}`);0===t?(a.innerHTML="",commentsData[e]={comments:n.comments,page:0,hasMore:n.has_more,totalCount:n.total_count}):(commentsData[e].comments.push(...n.comments),commentsData[e].hasMore=n.has_more),commentsData[e].page=t,renderCommentsForPost(e)}catch(e){console.error("Error loading comments:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}function renderCommentsForPost(e){const t=document.getElementById(`comments-list-${e}`),o=commentsData[e];o&&(t.innerHTML="",o.comments.forEach(e=>{const o=createCommentElement(e);t.appendChild(o)}),o.hasMore&&t.insertAdjacentHTML("beforeend",`<button class="load-more-comments" onclick="loadMoreComments('${e}')" data-lang-key="home.comments.loadMoreComments">Load More Comments</button>`))}async function loadMoreComments(e){const t=commentsData[e];t&&await loadCommentsForPost(e,t.page+1)}function createCommentElement(e,t=!1){const o=document.createElement("div");o.className=t?"reply":"comment";const n=e.replies&&e.replies.length>0?`<div class="replies">${e.replies.map(e=>createCommentElement(e,!0).outerHTML).join("")}${e.has_more_replies?`<button class="load-more-replies" onclick="loadMoreReplies('${e.id}')" data-lang-key="home.comments.loadMoreReplies">Load More Replies (${e.total_replies-e.replies.length} more)</button>`:""}</div>`:"";return o.innerHTML=`<img class="comment-avatar" src="${e.avatar_url||"/placeholder.svg"}" alt="${e.username}"><div class="comment-content"><div class="comment-username">${e.global_name||e.username}${e.verification_badge?`<img class="verification-badge" src="${e.verification_badge}" alt="Verified" style="width:12px;height:12px;">`:""}</div><div class="comment-text">${e.content}</div><div class="comment-time">${new Date(1e3*e.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div>${t?"":`<div class="comment-actions"><button class="comment-like-btn ${e.user_liked?"liked":""}" onclick="toggleCommentLike('${e.id}')"><i class="fas fa-heart"></i> ${e.likes_count||0}</button><button class="reply-btn" onclick="showReplyForm('${e.id}')" data-lang-key="home.comments.reply">Reply</button></div>`}${t?"":`<div class="reply-form hidden" id="reply-form-${e.id}"><div style="display:flex;gap:12px;margin-top:12px;"><textarea class="comment-input" data-lang-placeholder="home.comments.writeReply" maxlength="${window.getHomeConfig?window.getHomeConfig("limits.maxCommentLength",150):150}" style="font-size:12px;padding:8px 12px;"></textarea><button class="comment-btn" onclick="postReply('${e.post_id}','${e.id}')" style="width:36px;height:36px;"><i class="fas fa-paper-plane"></i></button></div></div>`}</div>${n}`,o}async function toggleCommentLike(e){try{const t=await fetch(`/api/comments/${e}/like`,{method:"POST"}),o=await t.json(),n=document.querySelector(`[onclick="toggleCommentLike('${e}')"]`);n.innerHTML=`<i class="fas fa-heart"></i> ${o.likes_count}`,o.is_liked?n.classList.add("liked"):n.classList.remove("liked"),playSound("message")}catch(e){console.error("Error toggling comment like:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}async function loadMoreReplies(e){try{const t=document.querySelector(`[onclick="loadMoreReplies('${e}')"]`),o=parseInt(t.getAttribute("data-page"))||1,n=e.split("_")[0]||activeCommentsSection,a=await fetch(`/api/posts/${n}/comments/${e}/replies?page=${o}`),s=await a.json(),c=t.parentNode,r=document.createElement("div");s.replies.forEach(e=>{const t=createCommentElement(e,!0);r.appendChild(t)}),c.insertBefore(r,t),s.has_more?t.setAttribute("data-page",o+1):t.remove()}catch(e){console.error("Error loading more replies:",e)}}function showReplyForm(e){document.querySelectorAll(".reply-form").forEach(e=>e.classList.add("hidden"));const t=document.getElementById(`reply-form-${e}`);t&&(t.classList.remove("hidden"),t.querySelector("textarea").focus())}function handleCommentKeypress(e,t){"Enter"===e.key&&!e.shiftKey&&(e.preventDefault(),postComment(t))}async function postComment(e){const t=document.querySelector(`#comments-${e} .comment-form .comment-input`),o=t.value.trim();if(!o)return;const n=window.getHomeConfig?window.getHomeConfig("limits.maxCommentLength",150):150;if(o.length>n)return void showToast(window.langConfig?.getText("home.messages.commentTooLong")||"Comment is too long","error");try{await fetch(`/api/posts/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:o})}),t.value="",smartUpdateSystem.saveUserInput(`comment-${e}`,""),showToast(window.langConfig?.getText("home.messages.commentSuccess")||"Comment posted successfully","success"),await loadCommentsForPost(e,0)}catch(e){console.error("Error posting comment:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}async function postReply(e,t){const o=document.querySelector(`#reply-form-${t} textarea`),n=o.value.trim();if(!n)return;const a=window.getHomeConfig?window.getHomeConfig("limits.maxCommentLength",150):150;if(n.length>a)return void showToast(window.langConfig?.getText("home.messages.commentTooLong")||"Comment is too long","error");try{await fetch(`/api/posts/${e}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n,parent_id:t})}),o.value="",document.getElementById(`reply-form-${t}`).classList.add("hidden"),showToast(window.langConfig?.getText("home.messages.replySuccess")||"Reply posted successfully","success"),await loadCommentsForPost(e,0)}catch(e){console.error("Error posting reply:",e),showToast(window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}function handleFileSelect(){const e=fileInput.files[0];if(!e)return;if(!validateMedia(e))return void(fileInput.value="");selectedMedia=e,mediaType=e.type.startsWith("image/")?"image":e.type.startsWith("video/")?"video":e.name.toLowerCase().endsWith(".gif")||e.type.includes("gif")?"gif":"image";const t=new FileReader;t.onload=function(e){mediaPreview.classList.remove("hidden"),"image"===mediaType||"gif"===mediaType?(previewImage.src=e.target.result,previewImage.classList.remove("hidden"),previewVideo.classList.add("hidden")):"video"===mediaType&&(previewVideo.src=e.target.result,previewVideo.classList.remove("hidden"),previewImage.classList.add("hidden"))},t.readAsDataURL(e)}function removeMedia(){selectedMedia=null,mediaType=null,mediaPreview.classList.add("hidden"),previewImage.classList.add("hidden"),previewVideo.classList.add("hidden"),fileInput.value=""}async function createPost(){if(isUploading)return void showToast(window.langConfig?.getText("home.messages.uploadInProgress")||"Upload in progress","warning");const e=postContent.value.trim();if(!e&&!selectedMedia)return void showToast(window.langConfig?.getText("home.messages.enterContent")||"Please enter some content","error");const t=window.getHomeConfig?window.getHomeConfig("limits.maxPostLength",100):100;if(e.length>t)return void showToast(window.langConfig?.getText("home.messages.postTooLong")||"Post is too long","error");if(selectedMedia&&!validateMedia(selectedMedia))return;isUploading=!0,postBtn.disabled=!0,postBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> Posting...';const o=async()=>{let t=null;if(selectedMedia){showUploadProgress(0,window.langConfig?.getText("home.media.preparing")||"Preparing upload...");const e=simulateUploadProgress();try{const e=new FileReader;t=await new Promise(t=>{e.onload=()=>t(e.result),e.readAsDataURL(selectedMedia)}),clearInterval(e),showUploadProgress(95,window.langConfig?.getText("home.media.finalizing")||"Finalizing...")}catch(t){throw clearInterval(e),hideUploadProgress(),new Error("Failed to process media")}}try{const o={content:e,type:mediaType||"text"};t&&(o.media_data=t);const n=await fetch("/api/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(hideUploadProgress(),n.ok){const t=await n.json();posts.unshift(t),smartUpdateSystem.queueUpdate(renderPosts,3),postContent.value="",updateCharCounter(),removeMedia(),showToast(window.langConfig?.getText("home.messages.postSuccess")||"Post created successfully","success")}else{const e=await n.json();throw new Error(e.error||"Failed to create post")}}catch(e){throw hideUploadProgress(),e}finally{isUploading=!1,postBtn.disabled=!1,postBtn.innerHTML=window.langConfig?.getText("home.createPost.sharePost")||"Share Post"}};if(uploadQueue.length>0||activeUploads>=maxConcurrentUploads)addToUploadQueue({callback:o});else try{await o()}catch(e){console.error("Error creating post:",e),showToast(e.message||window.langConfig?.getText("home.messages.errorOccurred")||"An error occurred","error")}}document.addEventListener("visibilitychange",function(){isPageVisible=!document.hidden,isPageVisible&&pendingPosts.length>0&&showNewPostsIndicator()}),document.addEventListener("input",trackUserInteraction),document.addEventListener("click",trackUserInteraction),document.addEventListener("keydown",trackUserInteraction),document.addEventListener("scroll",trackUserInteraction),document.addEventListener("click",e=>{e.target.closest(".main-reaction-btn")||e.target.closest(".reaction-picker")||hideAllReactionPickers(),document.querySelectorAll(".post-options-menu").forEach(t=>{t.contains(e.target)||t.previousElementSibling.contains(e.target)||t.classList.remove("active")})}),postContent.addEventListener("input",()=>{updateCharCounter(),smartUpdateSystem.saveUserInput("main-post-content",postContent.value)}),document.getElementById("image-btn").addEventListener("click",()=>{if(isUploading)return void showToast(window.langConfig?.getText("home.messages.uploadInProgress")||"Upload in progress","warning");fileInput.accept="image/*",fileInput.click()}),document.getElementById("video-btn").addEventListener("click",()=>{if(isUploading)return void showToast(window.langConfig?.getText("home.messages.uploadInProgress")||"Upload in progress","warning");fileInput.accept="video/*",fileInput.click()}),document.getElementById("gif-btn").addEventListener("click",()=>{if(isUploading)return void showToast(window.langConfig?.getText("home.messages.uploadInProgress")||"Upload in progress","warning");fileInput.accept=".gif",fileInput.click()}),fileInput.addEventListener("change",handleFileSelect),removeMediaBtn.addEventListener("click",removeMedia),postBtn.addEventListener("click",createPost),loadMoreBtn.addEventListener("click",()=>{!isLoading&&hasMorePosts&&loadPosts(!0)}),loginBtn.addEventListener("click",()=>{window.location.href="/auth/discord"}),logoutBtn.addEventListener("click",()=>{localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/logout"}),toggleSidebarBtn.addEventListener("click",toggleSidebar),bottomToggleBtn.addEventListener("click",toggleSidebar),likesModal.addEventListener("click",e=>{e.target===likesModal&&closeLikesModal()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&exitFullscreen()}),document.addEventListener("DOMContentLoaded",function(){if(loadSidebarState()&&sidebar.classList.add("collapsed"),window.langConfig){const e=localStorage.getItem("selectedLanguage");e&&window.langConfig.setLanguage(e),window.langConfig.updateUI()}checkAuth(),fetch("/api/settings").then(e=>e.json()).then(e=>{e.logo&&(document.getElementById("logo-img").src=e.logo)}).catch(console.error),document.addEventListener("click",()=>{fetch("/api/notifications/mark-read",{method:"POST"}).then(()=>{updateNotificationCount(-notificationCount)}).catch(console.error)},{once:!0}),setTimeout(()=>{smartUpdateSystem.restoreUserInput("main-post-content")},1e3)});</script><script src="https://cdn.gpteng.co/gptengineer.js" type="module"></script></body></html>
