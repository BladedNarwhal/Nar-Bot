
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Manage Categories - Store</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <style>
        :root{--primary-color:#7e69ab;--secondary-color:#9b87f5;--dark-color:#1a1f2c;--text-color:#e5deff;--success-color:#48bb78;--warning-color:#f6ad55;--danger-color:#f56565;--gray-color:#a0aec0;--glass-bg:rgba(26, 31, 44, 0.85);--glass-border:rgba(155, 135, 245, 0.4);--accent-gradient:linear-gradient(135deg, #667eea 0%, #764ba2 100%)}*{margin:0;padding:0;box-sizing:border-box;font-family:Tajawal,Poppins,sans-serif}body{background:linear-gradient(135deg, #667eea 0%, #764ba2 100%);background-attachment:fixed;color:var(--text-color);padding:20px;min-height:100vh}.container{max-width:1200px;margin:0 auto}.header{text-align:center;margin-bottom:40px}.header h1{font-size:36px;font-weight:700;background:var(--accent-gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}.back-btn{background:var(--primary-color);color:white;border:none;padding:12px 24px;border-radius:12px;cursor:pointer;margin-bottom:30px;text-decoration:none;display:inline-flex;align-items:center;gap:8px}.back-btn:hover{background:var(--secondary-color)}.categories-section{background:var(--glass-bg);backdrop-filter:blur(20px);border:2px solid var(--glass-border);border-radius:25px;padding:30px;margin-bottom:30px}.btn{padding:12px 24px;border-radius:12px;border:none;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;transition:all 0.3s}.btn-success{background:var(--success-color);color:white}.btn-warning{background:var(--warning-color);color:white}.btn-danger{background:var(--danger-color);color:white}.btn:hover{transform:translateY(-2px)}.categories-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;margin-top:20px}.category-card{background:rgba(26,31,44,0.8);border:2px solid var(--glass-border);border-radius:15px;padding:20px;transition:all 0.3s}.category-card:hover{border-color:var(--primary-color);transform:translateY(-5px)}.category-title{font-size:20px;font-weight:700;margin-bottom:10px;color:var(--text-color)}.category-description{color:var(--gray-color);margin-bottom:15px;font-size:14px}.category-stats{font-size:12px;color:var(--gray-color);margin-bottom:15px}.category-actions{display:flex;gap:10px}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center}.modal.active{display:flex}.modal-content{background:var(--glass-bg);backdrop-filter:blur(30px);border:2px solid var(--glass-border);border-radius:25px;padding:40px;max-width:500px;width:95%}.form-group{margin-bottom:20px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--text-color)}.form-group input,.form-group textarea{width:100%;padding:15px;border:2px solid var(--glass-border);border-radius:12px;background:rgba(26,31,44,0.8);color:var(--text-color);font-size:14px}.form-group input:focus,.form-group textarea:focus{outline:none;border-color:var(--primary-color)}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <a href="/Store" class="back-btn">
                <i class="fas fa-arrow-left"></i> Back to Store
            </a>
            <h1><i class="fas fa-tags"></i> Manage Categories</h1>
        </div>

        <div class="categories-section">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
                <h3>Store Categories</h3>
                <button class="btn btn-success" id="add-category-btn">
                    <i class="fas fa-plus"></i> Add Category
                </button>
            </div>
            <div id="categories-grid" class="categories-grid"></div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">Add New Category</h3>
            <form id="category-form">
                <div class="form-group">
                    <label for="category-name">Category Name</label>
                    <input type="text" id="category-name" required>
                </div>
                <div class="form-group">
                    <label for="category-description">Description (Optional)</label>
                    <textarea id="category-description" rows="3"></textarea>
                </div>
                <div style="display:flex;gap:15px;">
                    <button type="submit" class="btn btn-success">Save</button>
                    <button type="button" class="btn btn-danger" id="close-modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        let categories = [];
        let editingId = null;

        function showToast(title, message, type = 'info') {
            alert(`${title}: ${message}`);
        }

        function loadCategories() {
            fetch('/api/store/categories')
                .then(response => response.json())
                .then(data => {
                    categories = data;
                    renderCategories();
                })
                .catch(console.error);
        }

        function renderCategories() {
            const container = document.getElementById('categories-grid');
            container.innerHTML = '';
            
            categories.forEach(category => {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `
                    <div class="category-title">${category.name}</div>
                    <div class="category-description">${category.description || 'No description'}</div>
                    <div class="category-stats">${category.product_count || 0} products</div>
                    <div class="category-actions">
                        <button class="btn btn-warning" onclick="editCategory('${category.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger" onclick="deleteCategory('${category.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function editCategory(id) {
            const category = categories.find(c => c.id === id);
            if (!category) return;
            
            editingId = id;
            document.getElementById('modal-title').textContent = 'Edit Category';
            document.getElementById('category-name').value = category.name;
            document.getElementById('category-description').value = category.description || '';
            document.getElementById('category-modal').classList.add('active');
        }

        function deleteCategory(id) {
            if (!confirm('Are you sure you want to delete this category?')) return;
            
            fetch(`/api/store/categories/${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Success', 'Category deleted successfully!', 'success');
                    loadCategories();
                } else {
                    showToast('Error', data.error || 'Failed to delete category', 'error');
                }
            })
            .catch(() => showToast('Error', 'An error occurred', 'error'));
        }

        document.getElementById('add-category-btn').addEventListener('click', () => {
            editingId = null;
            document.getElementById('modal-title').textContent = 'Add New Category';
            document.getElementById('category-form').reset();
            document.getElementById('category-modal').classList.add('active');
        });

        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('category-modal').classList.remove('active');
        });

        document.getElementById('category-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const data = {
                name: document.getElementById('category-name').value,
                description: document.getElementById('category-description').value
            };
            
            const url = editingId ? `/api/store/categories/${editingId}` : '/api/store/categories';
            const method = editingId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Success', editingId ? 'Category updated!' : 'Category created!', 'success');
                    document.getElementById('category-modal').classList.remove('active');
                    loadCategories();
                } else {
                    showToast('Error', data.error || 'Failed to save category', 'error');
                }
            })
            .catch(() => showToast('Error', 'An error occurred', 'error'));
        });

        loadCategories();
    </script>
</body>
</html>
