<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Premium Store - Community Server TovStudio</title><meta name=description content="Premium Store System"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><script src=https://cdn.socket.io/4.6.0/socket.io.min.js></script><script src=system-config.js></script><script>document.addEventListener('DOMContentLoaded',function(){const e=window.systemConfig?.store?.paypalClientId||'ARq3InItpUR8jknkVyCtQIXTQwsHSeOvKdURLEretiaEDBVfmwo0voanVeZ4GCIGbkejtYVOtg6WKpAX';if(e){const t=document.createElement('script');t.src=`https://www.paypal.com/sdk/js?client-id=${e}&currency=USD`,document.head.appendChild(t)}})</script><style>:root{--primary-color:#7e69ab;--primary-hover:#6b5b9a;--secondary-color:#9b87f5;--secondary-hover:#8b77f0;--dark-color:#1a1f2c;--darker-color:#151a26;--light-color:#f1f0fb;--text-color:#e5deff;--text-muted:#b8b4d1;--success-color:#48bb78;--warning-color:#f6ad55;--danger-color:#f56565;--gray-color:#a0aec0;--glass-bg:rgba(26,31,44,0.85);--glass-border:rgba(155,135,245,0.3);--glass-hover:rgba(155,135,245,0.1);--shadow-sm:0 2px 4px rgba(0,0,0,0.1);--shadow-md:0 4px 6px rgba(0,0,0,0.1);--shadow-lg:0 10px 15px rgba(0,0,0,0.2);--border-radius:12px;--border-radius-sm:8px;--border-radius-lg:16px;--transition:all 0.3s cubic-bezier(0.4,0,0.2,1);--transition-fast:all 0.2s cubic-bezier(0.4,0,0.2,1)}*{margin:0;padding:0;box-sizing:border-box;font-family:Tajawal,Poppins,sans-serif}body{background:linear-gradient(135deg,var(--dark-color) 0,var(--darker-color) 100%);color:var(--text-color);min-height:100vh;overflow-x:hidden;background-size:cover;background-position:center;background-attachment:fixed}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(126,105,171,.1) 0,transparent 50%),radial-gradient(circle at 80% 20%,rgba(155,135,245,.1) 0,transparent 50%),radial-gradient(circle at 40% 80%,rgba(126,105,171,.05) 0,transparent 50%);pointer-events:none;z-index:-1}.container{display:flex;min-height:100vh;position:relative}.sidebar{width:280px;background:var(--glass-bg);backdrop-filter:blur(20px);border-right:1px solid var(--glass-border);padding:0;display:flex;flex-direction:column;transition:var(--transition);z-index:100;box-shadow:var(--shadow-lg)}.sidebar.collapsed{width:80px}.logo-container{padding:24px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--glass-border);background:linear-gradient(135deg,var(--glass-bg) 0,rgba(155,135,245,.1) 100%)}.logo{display:flex;align-items:center;transition:var(--transition)}.logo img{width:42px;height:42px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-color);transition:var(--transition)}.logo img:hover{transform:scale(1.05);border-color:var(--secondary-color)}.logo-text{font-size:18px;font-weight:700;color:var(--text-color);white-space:nowrap;transition:var(--transition)}.menu-toggle{cursor:pointer;color:var(--text-color);background:0 0;border:none;font-size:20px;padding:8px;border-radius:var(--border-radius-sm);transition:var(--transition)}.menu-toggle:hover{background:var(--glass-hover);transform:scale(1.1)}.sidebar.collapsed .logo-text{opacity:0;transform:translateX(-20px)}.menu{list-style:none;padding:20px 0;margin:0;flex:1}.menu-item{padding:16px 24px;display:flex;align-items:center;cursor:pointer;color:var(--text-muted);transition:var(--transition);position:relative;margin:4px 12px;border-radius:var(--border-radius)}.menu-item::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.menu-item.active,.menu-item:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.menu-item.active::before,.menu-item:hover::before{height:24px}.menu-item i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition)}.menu-item:hover i{transform:scale(1.1)}.menu-text{font-weight:500;transition:var(--transition)}.sidebar.collapsed .menu-text{opacity:0;transform:translateX(-20px)}.sidebar-bottom-toggle{display:none;padding:16px 24px;margin:4px 12px;cursor:pointer;color:var(--text-muted);background:transparent;border:none;border-radius:var(--border-radius);transition:var(--transition);justify-content:flex-start;align-items:center;font-size:18px;position:relative}.sidebar-bottom-toggle::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.sidebar-bottom-toggle:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.sidebar-bottom-toggle:hover::before{height:24px}.sidebar-bottom-toggle i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition)}.sidebar-bottom-toggle:hover i{transform:scale(1.1)}.sidebar.collapsed .sidebar-bottom-toggle{display:flex}.sidebar.collapsed .menu-toggle{display:none}.main-content{flex:1;padding:32px;overflow-y:auto;position:relative}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;padding:24px 32px;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md)}.header h1{font-size:28px;font-weight:700;color:var(--text-color)}#welcome-message{font-size:18px;font-weight:600;color:var(--text-color)}.store-controls{display:flex;gap:15px;margin-bottom:30px;flex-wrap:wrap}.btn{padding:12px 24px;border-radius:var(--border-radius);border:none;font-weight:600;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;font-size:14px;box-shadow:var(--shadow-sm);position:relative;overflow:hidden}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:var(--transition)}.btn:hover::before{left:100%}.btn-primary{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff}.btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-success{background:linear-gradient(135deg,var(--success-color),#38a169);color:#fff}.btn-success:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-warning{background:linear-gradient(135deg,var(--warning-color),#ed8936);color:#fff}.btn-warning:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-danger{background:linear-gradient(135deg,var(--danger-color),#e53e3e);color:#fff}.btn-danger:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-secondary{background:var(--glass-bg);color:var(--text-color);border:1px solid var(--primary-color)}.btn-secondary:hover{background:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-md)}.categories-container{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:25px;margin-bottom:40px}.category-card{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:30px;cursor:pointer;transition:var(--transition);text-align:center;position:relative;overflow:hidden;box-shadow:var(--shadow-md)}.category-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));opacity:0;transition:var(--transition);z-index:-1}.category-card:hover{transform:translateY(-4px);border-color:var(--primary-color);box-shadow:var(--shadow-lg)}.category-card:hover::before{opacity:.1}.category-card.active{border-color:var(--success-color);background:rgba(72,187,120,.15);box-shadow:0 0 30px rgba(72,187,120,.3)}.category-card i{font-size:48px;color:var(--primary-color);margin-bottom:15px;transition:var(--transition)}.category-card:hover i{transform:scale(1.2);color:var(--secondary-color)}.category-card h4{font-size:20px;font-weight:600;margin-bottom:10px;color:var(--text-color)}.products-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:30px;margin-bottom:40px}.product-card{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);overflow:hidden;transition:var(--transition);position:relative;box-shadow:var(--shadow-md)}.product-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));opacity:0;transition:var(--transition);z-index:-1}.product-card:hover{transform:translateY(-4px);box-shadow:var(--shadow-lg);border-color:var(--primary-color)}.product-card:hover::before{opacity:.05}.product-image{width:100%;height:220px;object-fit:cover;background:var(--dark-color);transition:var(--transition)}.product-card:hover .product-image{transform:scale(1.05)}.product-content{padding:25px}.product-title{font-size:20px;font-weight:700;margin-bottom:12px;color:var(--text-color)}.product-description{color:var(--gray-color);margin-bottom:20px;font-size:14px;line-height:1.6}.product-price{font-size:24px;font-weight:700;color:var(--success-color);margin-bottom:20px;text-shadow:0 2px 4px rgba(72,187,120,.3)}.product-footer{display:flex;justify-content:space-between;align-items:center;gap:10px}.product-stats{background:rgba(26,31,44,.9);padding:15px;margin:15px 0;border-radius:var(--border-radius);border:1px solid var(--glass-border)}.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:15px;text-align:center}.stat-item{display:flex;flex-direction:column;align-items:center}.stat-number{font-size:18px;font-weight:700;color:var(--primary-color);margin-bottom:5px}.stat-label{font-size:12px;color:var(--gray-color);text-transform:uppercase}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);z-index:1000;align-items:center;justify-content:center}.modal.active{display:flex;animation:modalSlideIn .4s cubic-bezier(.175,.885,.32,1.275)}.modal-content{background:var(--glass-bg);backdrop-filter:blur(30px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:40px;max-width:700px;width:95%;max-height:90%;overflow-y:auto;position:relative;box-shadow:var(--shadow-lg)}.modal h3{font-size:24px;font-weight:700;margin-bottom:30px;color:var(--text-color);text-align:center}.form-group{margin-bottom:25px}.form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--text-color)}.form-group input,.form-group select,.form-group textarea{width:100%;padding:15px 20px;border:2px solid var(--glass-border);border-radius:var(--border-radius);background:rgba(26,31,44,.8);color:var(--text-color);font-size:14px;transition:var(--transition);backdrop-filter:blur(10px)}.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 20px rgba(126,105,171,.3);transform:translateY(-2px)}.purchases-container{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:30px;box-shadow:var(--shadow-md)}.purchase-item{display:flex;align-items:center;gap:20px;padding:20px;border-bottom:1px solid var(--glass-border);transition:var(--transition);border-radius:var(--border-radius);margin-bottom:15px;position:relative}.purchase-item:hover{background:rgba(155,135,245,.1);transform:translateX(10px)}.purchase-image{width:80px;height:80px;object-fit:cover;border-radius:var(--border-radius);border:2px solid var(--primary-color)}.purchase-details{flex:1}.purchase-title{font-weight:700;margin-bottom:8px;font-size:16px;color:var(--text-color)}.purchase-date{color:var(--gray-color);font-size:12px;margin-bottom:5px}.purchase-price{font-weight:700;color:var(--success-color);font-size:18px}.renewal-warning{background:rgba(246,173,85,.2);border:1px solid var(--warning-color);border-radius:var(--border-radius-sm);padding:10px;margin:10px 0;color:var(--warning-color);font-size:12px;display:flex;align-items:center;gap:8px}.renewal-warning i{font-size:14px}.renewal-btn{padding:8px 16px;font-size:12px;background:var(--warning-color);color:#fff;border:none;border-radius:var(--border-radius-sm);cursor:pointer;transition:var(--transition)}.renewal-btn:hover{background:#ed8936;transform:translateY(-1px)}.admin-panel{background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:30px;margin-bottom:30px;box-shadow:var(--shadow-md);position:relative}.admin-panel h3{font-size:22px;font-weight:700;margin-bottom:25px;color:var(--text-color)}.admin-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-bottom:25px}.stat-card{background:rgba(26,31,44,.8);padding:25px;border-radius:var(--border-radius);text-align:center;border:1px solid var(--glass-border);transition:var(--transition);position:relative;overflow:hidden}.stat-card:hover{transform:translateY(-4px);border-color:var(--primary-color)}.stat-number{font-size:32px;font-weight:700;color:var(--primary-color);text-shadow:0 2px 4px rgba(126,105,171,.3)}.stat-label{color:var(--gray-color);font-size:14px;margin-top:8px}.discount-section{background:rgba(26,31,44,.9);padding:20px;border-radius:var(--border-radius);margin:20px 0;border:1px solid var(--glass-border)}.discount-input-group{display:flex;gap:10px;margin-bottom:15px}.discount-input{flex:1;padding:12px 15px;border:2px solid var(--glass-border);border-radius:var(--border-radius-sm);background:rgba(26,31,44,.8);color:var(--text-color);font-size:14px}.discount-btn{padding:12px 20px;border:none;border-radius:var(--border-radius-sm);background:var(--warning-color);color:#fff;font-weight:600;cursor:pointer;transition:var(--transition)}.discount-info{display:none;padding:15px;background:rgba(72,187,120,.2);border:1px solid var(--success-color);border-radius:var(--border-radius-sm);color:var(--success-color)}.discount-info.active{display:block}.paypal-container{margin-top:30px;padding:25px;background:rgba(26,31,44,.8);border-radius:var(--border-radius-lg);border:2px solid var(--glass-border);text-align:center}.purchase-modal .modal-content{max-width:500px}.purchase-details{text-align:center;margin-bottom:30px}.purchase-details img{max-width:250px;max-height:250px;object-fit:cover;border-radius:var(--border-radius);margin-bottom:20px;border:3px solid var(--primary-color);box-shadow:0 10px 30px rgba(126,105,171,.3)}.purchase-details h4{font-size:24px;font-weight:700;margin-bottom:15px;color:var(--text-color)}.purchase-details p{color:var(--gray-color);margin-bottom:20px;line-height:1.6}.purchase-price-display{font-size:36px;font-weight:700;color:var(--success-color);margin:20px 0;text-shadow:0 2px 4px rgba(72,187,120,.3)}#toast-container{position:fixed;top:24px;right:24px;z-index:2000}.toast{display:flex;align-items:center;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:16px 24px;margin-bottom:12px;min-width:320px;max-width:480px;box-shadow:var(--shadow-lg);opacity:0;transform:translateX(100%);animation:slideInRight .4s ease-out forwards}.toast.removing{animation:slideOutRight .4s ease-out forwards}.toast-icon{font-size:20px;margin-right:16px;flex-shrink:0}.toast-content{flex:1}.toast-title{font-weight:600;font-size:15px;margin-bottom:4px}.toast-message{font-size:14px;color:var(--text-muted);line-height:1.4}.toast-close{background:0 0;border:none;color:var(--gray-color);font-size:18px;cursor:pointer;padding:4px;border-radius:4px;transition:var(--transition);margin-left:12px}.toast-close:hover{color:var(--text-color);background:var(--glass-hover)}.no-products-message{text-align:center;color:var(--gray-color);font-size:18px;padding:60px 20px;background:var(--glass-bg);backdrop-filter:blur(20px);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);margin:20px 0}.no-products-message i{font-size:48px;margin-bottom:20px;display:block;color:var(--primary-color)}@keyframes modalSlideIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}@keyframes slideInRight{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}@keyframes slideOutRight{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}@media (max-width:768px){.container{flex-direction:column}.sidebar{width:100%;border-right:none;border-bottom:1px solid var(--glass-border);position:relative}.sidebar.collapsed{width:100%}.main-content{padding:16px}.products-grid{grid-template-columns:1fr}.categories-container{grid-template-columns:1fr}.admin-stats{grid-template-columns:1fr}.store-controls{justify-content:center}.btn{padding:10px 20px;font-size:12px}}</style><script src=https://cdn.gpteng.co/gptengineer.js type=module></script><script src=lang-config.js></script></head><body><div class=container><div class=sidebar><div class=logo-container><div class=logo><img src="" id=logo-img alt=Logo><div class=logo-text data-lang-key=sidebar.title>Store System</div></div><button class=menu-toggle id=toggle-sidebar><i class="fas fa-bars"></i></button></div><ul class=menu><li class=menu-item onclick='window.location.href="/"'><i class="fas fa-home"></i><span class=menu-text data-lang-key=sidebar.home>Home</span></li><li class=menu-item onclick='window.location.href="/"'><i class="fas fa-chart-bar"></i><span class=menu-text data-lang-key=sidebar.dashboard>Dashboard</span></li><li class=menu-item onclick='window.location.href="/Tickets"'><i class="fas fa-ticket"></i><span class=menu-text data-lang-key=sidebar.tickets>Tickets</span></li><li class=menu-item onclick='window.location.href="/Users"'><i class="fas fa-users"></i><span class=menu-text data-lang-key=sidebar.users>Users</span></li><li class=menu-item onclick='window.location.href="/Ratings"'><i class="fas fa-star"></i><span class=menu-text data-lang-key=sidebar.ratings>Ratings</span></li><li class="menu-item active" onclick='window.location.href="/Store"'><i class="fas fa-store"></i><span class=menu-text data-lang-key=store.title>Store</span></li><li class=menu-item onclick='window.location.href="/Settings"'><i class="fas fa-cog"></i><span class=menu-text data-lang-key=sidebar.settings>Settings</span></li><li class=menu-item id=logout-btn><i class="fas fa-sign-out-alt"></i><span class=menu-text data-lang-key=sidebar.logout>Logout</span></li></ul><button class="sidebar-bottom-toggle" id="bottom-toggle-sidebar"><i class="fas fa-bars"></i></button></div><div class=main-content><div class=header><h1><i class="fas fa-store"></i> <span data-lang-key=store.title>Premium Store</span></h1><div id=welcome-message></div></div><div id=admin-panel class=admin-panel style=display:none><h3><i class="fas fa-crown"></i> <span data-lang-key=store.adminPanel.title>Admin Control Panel</span></h3><div class=admin-stats><div class=stat-card><div class=stat-number id=total-products>0</div><div class=stat-label data-lang-key=store.adminPanel.totalProducts>Total Products</div></div><div class=stat-card><div class=stat-number id=total-categories>0</div><div class=stat-label data-lang-key=store.adminPanel.categories>Categories</div></div><div class=stat-card><div class=stat-number id=total-sales>0</div><div class=stat-label data-lang-key=store.adminPanel.totalSales>Total Sales</div></div><div class=stat-card><div class=stat-number id=total-revenue>$0</div><div class=stat-label data-lang-key=store.adminPanel.revenue>Revenue</div></div></div><div class=store-controls><button class="btn btn-success" id=add-product-btn><i class="fas fa-plus-circle"></i> <span data-lang-key=store.adminPanel.addProduct>Add Product</span></button><button class="btn btn-warning" id=manage-categories-btn><i class="fas fa-tags"></i> <span data-lang-key=store.adminPanel.manageCategories>Manage Categories</span></button><button class="btn btn-primary" id=view-orders-btn><i class="fas fa-chart-line"></i> <span data-lang-key=store.adminPanel.viewAnalytics>View Analytics</span></button><button class="btn btn-danger" id=manage-discounts-btn><i class="fas fa-percent"></i> <span data-lang-key=store.adminPanel.discountCodes>Discount Codes</span></button></div></div><div class=store-controls><button class="btn btn-primary" id=my-purchases-btn><i class="fas fa-shopping-bag"></i> <span data-lang-key=store.controls.myPurchases>My Purchases</span></button><button class="btn btn-success" id=all-categories-btn><i class="fas fa-th-large"></i> <span data-lang-key=store.controls.allCategories>All Categories</span></button></div><div id=categories-container class=categories-container></div><div id=products-container class=products-grid></div><div id=purchases-container class=purchases-container style=display:none><h3><i class="fas fa-shopping-bag"></i> <span data-lang-key=store.purchases.title>My Premium Purchases</span></h3><div id=purchases-list></div></div></div></div><div id=product-modal class=modal><div class=modal-content><h3 id=modal-title data-lang-key=store.modal.addProduct>Add New Product</h3><form id=product-form><div class=form-group><label for=product-category><i class="fas fa-tag"></i> <span data-lang-key=store.modal.category>Category (Optional)</span></label><select id=product-category><option value="" data-lang-key=store.modal.selectCategory>Select Category (Optional)</option></select><input id=new-category data-lang-placeholder=store.modal.createCategory placeholder="Or create new category" style=margin-top:10px></div><div class=form-group><label for=product-title><i class="fas fa-heading"></i> <span data-lang-key=store.modal.productTitle>Product Title</span></label><input id=product-title required data-lang-placeholder=store.modal.titlePlaceholder placeholder="Enter product title"></div><div class=form-group><label for=product-description><i class="fas fa-align-left"></i> <span data-lang-key=store.modal.description>Description</span></label><textarea id=product-description rows=4 required data-lang-placeholder=store.modal.descriptionPlaceholder placeholder="Enter product description"></textarea></div><div class=form-group><label for=product-price><i class="fas fa-dollar-sign"></i> <span data-lang-key=store.modal.price>Price ($)</span></label><input type=number id=product-price step=0.01 min=0 required data-lang-placeholder=store.modal.pricePlaceholder placeholder=0.00></div><div class=form-group><label for=product-image><i class="fas fa-image"></i> <span data-lang-key=store.modal.imageUrl>Image URL</span></label><input type=url id=product-image data-lang-placeholder=store.modal.imagePlaceholder placeholder=https://example.com/image.jpg></div><div class=form-group><label for=product-video><i class="fas fa-video"></i> <span data-lang-key=store.modal.videoUrl>Video URL</span></label><input type=url id=product-video data-lang-placeholder=store.modal.videoPlaceholder placeholder=https://example.com/video.mp4></div><div class=form-group><label for=product-download><i class="fas fa-download"></i> <span data-lang-key=store.modal.downloadLink>Download Link</span></label><input type=url id=product-download data-lang-placeholder=store.modal.downloadPlaceholder placeholder=https://example.com/download></div><div class=form-group><label for=product-expiry><i class="fas fa-calendar-alt"></i> <span data-lang-key=store.modal.expiryDays>Expiry Days (leave empty for permanent)</span></label><input type=number id=product-expiry min=1 data-lang-placeholder=store.modal.expiryPlaceholder placeholder=30></div><div class=form-group><label for=product-role><i class="fas fa-user-tag"></i> Give Role ID (Optional)</label><input type=text id=product-role placeholder="Discord Role ID (e.g., 123456789012345678)" maxlength=20></div><div class=form-group style=display:flex;gap:15px><button type=submit class="btn btn-success"><i class="fas fa-save"></i> <span data-lang-key=store.modal.saveProduct>Save Product</span></button><button type=button class="btn btn-danger" id=close-modal><i class="fas fa-times"></i> <span data-lang-key=store.modal.cancel>Cancel</span></button></div></form></div></div><div id=purchase-modal class="modal purchase-modal"><div class=modal-content><h3><i class="fas fa-shopping-cart"></i> <span data-lang-key=store.purchase.title>Complete Your Purchase</span></h3><div id=purchase-details></div><div class=discount-section><h4><i class="fas fa-percent"></i> <span data-lang-key=store.purchase.discountCode>Discount Code</span></h4><div class=discount-input-group><input id=discount-code class=discount-input data-lang-placeholder=store.purchase.discountPlaceholder placeholder="Enter discount code"><button type=button class=discount-btn id=apply-discount-btn data-lang-key=store.purchase.applyDiscount>Apply</button></div><div id=discount-info class=discount-info><i class="fas fa-check-circle"></i> <span data-lang-key=store.purchase.discountApplied>Discount applied successfully!</span></div></div><div class=paypal-container><h4><i class="fab fa-paypal"></i> <span data-lang-key=store.purchase.paymentTitle>Secure Payment with PayPal</span></h4><p style="color:var(--gray-color);margin:15px 0" data-lang-key=store.purchase.paymentDescription>Complete your purchase securely using PayPal. Your payment is protected.</p><div id=paypal-button-container></div></div><button type=button class="btn btn-danger" id=close-purchase-modal><i class="fas fa-times"></i> <span data-lang-key=store.purchase.cancel>Cancel</span></button></div></div><div id=renew-modal class="modal purchase-modal"><div class=modal-content><h3><i class="fas fa-sync-alt"></i> Renew Subscription</h3><div id=renew-details></div><div class=discount-section><h4><i class="fas fa-percent"></i> Discount Code</h4><div class=discount-input-group><input id=renew-discount-code class=discount-input placeholder="Enter discount code"><button type=button class=discount-btn id=apply-renew-discount-btn>Apply</button></div><div id=renew-discount-info class=discount-info><i class="fas fa-check-circle"></i> Discount applied successfully!</div></div><div class=paypal-container><h4><i class="fab fa-paypal"></i> Secure Payment with PayPal</h4><p style="color:var(--gray-color);margin:15px 0">Complete your renewal securely using PayPal. Your payment is protected.</p><div id=renew-paypal-button-container></div></div><button type=button class="btn btn-danger" id=close-renew-modal><i class="fas fa-times"></i> Cancel</button></div></div><div id=toast-container></div><script>let currentUser=null,isAdmin=!1,isStoreAdmin=!1,currentCategory=null,products=[],categories=[],purchases=[],currentProduct=null,currentRenewal=null,appliedDiscount=0,renewDiscount=0,settings={};const sidebar=document.querySelector(".sidebar"),toggleSidebarBtn=document.getElementById("toggle-sidebar"),bottomToggleBtn=document.getElementById("bottom-toggle-sidebar"),socket=io(),config=window.systemConfig||{};function loadSidebarState(){const e=localStorage.getItem("sidebarCollapsed");return"true"===e}function saveSidebarState(e){localStorage.setItem("sidebarCollapsed",e.toString())}function toggleSidebar(){sidebar.classList.toggle("collapsed");const e=sidebar.classList.contains("collapsed");saveSidebarState(e)}function loadUserSettings(){try{const e=localStorage.getItem("userSettings");if(e)return settings=JSON.parse(e),void applySettings();fetch("/api/settings").then(e=>e.json()).then(e=>{settings=e,applySettings(),localStorage.setItem("userSettings",JSON.stringify(settings))}).catch(e=>{console.error("Error loading settings:",e)})}catch(e){console.error("Error loading settings:",e)}}function applySettings(){settings.background&&(document.body.style.backgroundImage=`url('${settings.background}')`),settings.logo&&(document.getElementById("logo-img").src=settings.logo)}function getStoreConfig(e,t=null){return config.store&&config.store[e]?config.store[e]:t}function showToast(e,t,o="info"){const n=document.getElementById("toast-container"),a=document.createElement("div");a.className="toast";let s="fa-info-circle";switch(o){case"success":s="fa-check-circle";break;case"error":s="fa-exclamation-circle";break;case"warning":s="fa-exclamation-triangle"}a.innerHTML=`<i class="fas ${s} toast-icon"></i><div class="toast-content"><div class="toast-title">${e}</div><div class="toast-message">${t}</div></div><button class="toast-close">&times;</button>`,n.appendChild(a);const c=()=>{a.classList.add("removing"),setTimeout(()=>{a.parentNode&&a.remove()},400)};setTimeout(c,getStoreConfig("toastDuration",5e3)),a.querySelector(".toast-close").addEventListener("click",c)}function checkAuth(){fetch("/api/auth/status").then(e=>e.json()).then(e=>{e.authenticated?(currentUser=e.user,isAdmin=e.isAdmin,updateWelcomeMessage(e.user),checkStoreAdmin()):window.location.href="/auth/discord"}).catch(()=>{window.location.href="/auth/discord"})}function updateWelcomeMessage(e){const t=window.langConfig.getText("header.welcome");document.getElementById("welcome-message").textContent=`${t}${e.global_name||e.username}`}function checkStoreAdmin(){fetch("/api/store/admin-check").then(e=>e.json()).then(e=>{isStoreAdmin=e.isStoreAdmin,isStoreAdmin&&(document.getElementById("admin-panel").style.display="block",loadAdminStats())}).catch(console.error)}function loadAdminStats(){fetch("/api/store/stats").then(e=>e.json()).then(e=>{document.getElementById("total-products").textContent=e.totalProducts,document.getElementById("total-categories").textContent=e.totalCategories,document.getElementById("total-sales").textContent=e.totalSales,document.getElementById("total-revenue").textContent=`$${e.totalRevenue}`}).catch(console.error)}function loadCategories(){fetch("/api/store/categories").then(e=>e.json()).then(e=>{categories=e,renderCategories(),updateCategorySelect()}).catch(console.error)}function loadProducts(e=null){if(null===e)return document.getElementById("products-container").innerHTML=`<div class="no-products-message"><i class="fas fa-box-open"></i><h3>Select a category to view products</h3><p>Choose a category from above to browse available products</p></div>`,void(products=[]);fetch(`/api/store/products?category=${e}`).then(e=>e.json()).then(e=>{products=e,renderProducts()}).catch(console.error)}function loadPurchases(){fetch("/api/store/purchases").then(e=>e.json()).then(e=>{purchases=e,renderPurchases()}).catch(console.error)}function renderCategories(){const e=document.getElementById("categories-container");e.innerHTML="",categories.forEach(t=>{const o=document.createElement("div");o.className="category-card";const n=window.langConfig.getText("store.products.count");o.innerHTML=`<i class="fas fa-tag"></i><h4>${t.name}</h4><p>${t.product_count||0} ${n}</p>`,o.addEventListener("click",()=>{currentCategory=t.id,document.querySelectorAll(".category-card").forEach(e=>e.classList.remove("active")),o.classList.add("active"),loadProducts(t.id)}),e.appendChild(o)})}function renderProducts(){const e=document.getElementById("products-container");if(e.innerHTML="",0===products.length)return void(e.innerHTML=`<div class="no-products-message"><i class="fas fa-box-open"></i><h3>No products found</h3><p>This category doesn't have any products yet</p></div>`);products.forEach(t=>{const o=document.createElement("div");o.className="product-card";const n=t.image?`<img src="${t.image}" alt="${t.title}" class="product-image"/>`:t.video?`<video class="product-image" controls><source src="${t.video}" type="video/mp4"></video>`:`<div class="product-image" style="display:flex;align-items:center;justify-content:center;background:var(--dark-color);"><i class="fas fa-image" style="font-size:48px;color:var(--gray-color);"></i></div>`,a=new Date(1e3*t.created_at).toLocaleDateString(),s=t.updated_at?new Date(1e3*t.updated_at).toLocaleDateString():a;o.innerHTML=`${n}<div class="product-content"><h4 class="product-title">${t.title}</h4><p class="product-description">${t.description}</p><div class="product-stats"><div class="stats-grid"><div class="stat-item"><div class="stat-number">${t.views||0}</div><div class="stat-label">${window.langConfig.getText("store.products.views")}</div></div><div class="stat-item"><div class="stat-number">${t.purchases||0}</div><div class="stat-label">${window.langConfig.getText("store.products.purchases")}</div></div><div class="stat-item"><div class="stat-number">${t.download_link?t.downloads||0:"N/A"}</div><div class="stat-label">${window.langConfig.getText("store.products.downloads")}</div></div></div><div style="margin-top:10px;font-size:11px;color:var(--gray-color);"><div>${window.langConfig.getText("store.products.published")}: ${a}</div><div>${window.langConfig.getText("store.products.updated")}: ${s}</div>${t.role_id?`<div style="color:var(--success-color);"><i class="fas fa-user-tag"></i> Role: ${t.role_id}</div>`:""}</div></div><div class="product-price">$${t.price}</div><div class="product-footer"><button class="btn btn-primary purchase-btn" data-id="${t.id}"><i class="fas fa-shopping-cart"></i> ${isStoreAdmin?window.langConfig.getText("store.products.freeAdmin"):window.langConfig.getText("store.products.buyNow")}</button>${isStoreAdmin?`<div style="display:flex;gap:8px;"><button class="btn btn-warning edit-btn" data-id="${t.id}" style="padding:8px 12px;"><i class="fas fa-edit"></i></button><button class="btn btn-danger delete-btn" data-id="${t.id}" style="padding:8px 12px;"><i class="fas fa-trash"></i></button></div>`:""}</div></div>`,e.appendChild(o)}),document.querySelectorAll(".purchase-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest("button").dataset.id,o=products.find(e=>e.id===t);if(o){getStoreConfig("productViewIncrement",!0)&&fetch(`/api/store/product/${t}/view`,{method:"POST"}),isStoreAdmin&&getStoreConfig("autoAdminClaim",!0)?handleFreePurchase(o):openPurchaseModal(o)}})}),isStoreAdmin&&(document.querySelectorAll(".edit-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest("button").dataset.id,o=products.find(e=>e.id===t);o&&editProduct(o)})}),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest("button").dataset.id;confirm(window.langConfig.getText("store.messages.deleteConfirm"))&&deleteProduct(t)})}))}function handleFreePurchase(e){fetch("/api/store/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.id,paypalOrderId:"ADMIN_FREE_"+Date.now(),amount:0})}).then(e=>e.json()).then(e=>{e.success?(showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("store.messages.claimSuccess"),"success"),loadPurchases(),loadAdminStats()):showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.claimError"),"error")}).catch(()=>{showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("toast.unknownError"),"error")})}function renderPurchases(){const e=document.getElementById("purchases-list");e.innerHTML="",0!==purchases.length?purchases.forEach(t=>{const o=document.createElement("div");o.className="purchase-item";const n=t.image?`<img src="${t.image}" alt="${t.title}" class="purchase-image"/>`:`<div class="purchase-image" style="display:flex;align-items:center;justify-content:center;background:var(--dark-color);border:2px solid var(--primary-color);"><i class="fas fa-box"></i></div>`,a=t.isExpired,s=t.canRenew&&!a;o.innerHTML=`${n}<div class="purchase-details"><div class="purchase-title">${t.title}</div><div class="purchase-date">${window.langConfig.getText("store.purchases.purchased")}: ${new Date(t.purchaseDate).toLocaleDateString()}</div>${t.expiryDate?`<div class="purchase-date ${a?'style="color:var(--danger-color);"':""}">${a?window.langConfig.getText("store.purchases.expired"):window.langConfig.getText("store.purchases.expires")}: ${new Date(t.expiryDate).toLocaleDateString()}</div>`:`<div class="purchase-date" style="color:var(--success-color);">${window.langConfig.getText("store.purchases.permanent")}</div>`}${s?`<div class="renewal-warning"><i class="fas fa-exclamation-triangle"></i> Your subscription expires in ${t.daysLeft} days</div>`:""}${t.renewal_count>0?`<div style="font-size:11px;color:var(--gray-color);margin-top:5px;"><i class="fas fa-sync-alt"></i> Renewed ${t.renewal_count} time(s)</div>`:""}</div><div class="purchase-price">$${t.price}</div><div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end;">${t.downloadLink&&!a?`<a href="${t.downloadLink}" target="_blank" class="btn btn-success" onclick="trackDownload('${t.product_id}')" style="font-size:12px;padding:6px 12px;"><i class="fas fa-download"></i> ${window.langConfig.getText("store.purchases.download")}</a>`:""}${s?`<button class="renewal-btn" onclick="openRenewalModal('${t.id}', '${t.title}', ${t.original_price})"><i class="fas fa-sync-alt"></i> Renew</button>`:""}${a?`<span style="color:var(--danger-color);font-size:12px;">${window.langConfig.getText("store.purchases.expired")}</span>`:""}</div>`,e.appendChild(o)}):e.innerHTML=`<p style="text-align:center;color:var(--gray-color);font-size:18px;padding:40px;">${window.langConfig.getText("store.purchases.noPurchases")}</p>`}function trackDownload(e){getStoreConfig("downloadTracking",!0)&&fetch(`/api/store/product/${e}/download`,{method:"POST"}).catch(console.error)}function openRenewalModal(e,t,o){currentRenewal={id:e,title:t,price:o},renewDiscount=0;const n=document.getElementById("renew-modal");document.getElementById("renew-details").innerHTML=`<div class="purchase-details"><h4>${t}</h4><p>Renew your subscription for another period</p><div class="purchase-price-display" id="renew-current-price">$${o}</div></div>`,document.getElementById("renew-discount-code").value="",document.getElementById("renew-discount-info").classList.remove("active"),n.classList.add("active"),renderRenewalPayPalButton()}function applyRenewalDiscount(){const e=document.getElementById("renew-discount-code").value.toUpperCase(),t=document.getElementById("renew-discount-info");e?fetch("/api/store/discount/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}).then(e=>e.json()).then(e=>{if(e.valid){renewDiscount=e.discount;const o=currentRenewal.price*(1-renewDiscount);document.getElementById("renew-current-price").innerHTML=`<div style="text-decoration:line-through;color:var(--gray-color);font-size:24px;">$${currentRenewal.price}</div><div>$${o.toFixed(2)}</div>`,t.classList.add("active"),showToast("Success","Discount applied successfully!","success"),renderRenewalPayPalButton()}else showToast("Error","Invalid discount code","error")}).catch(()=>{showToast("Error","Error validating discount code","error")}):showToast("Error","Please enter a discount code","error")}function renderRenewalPayPalButton(){document.getElementById("renew-paypal-button-container").innerHTML="";const e=currentRenewal.price*(1-renewDiscount);paypal.Buttons({createOrder:(t,o)=>o.order.create({purchase_units:[{amount:{value:e.toFixed(2),currency_code:getStoreConfig("currency","USD")},description:`${currentRenewal.title} - Subscription Renewal`}]}),onApprove:(t,o)=>o.order.capture().then(t=>{fetch(`/api/store/renew/${currentRenewal.id}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paypalOrderId:t.id,amount:e,discountCode:renewDiscount>0?document.getElementById("renew-discount-code").value:null})}).then(e=>e.json()).then(e=>{e.success?(showToast("Success","Subscription renewed successfully!","success"),document.getElementById("renew-modal").classList.remove("active"),loadPurchases()):showToast("Error","Failed to renew subscription","error")}).catch(()=>{showToast("Error","An error occurred","error")})}),onError:e=>{console.error("PayPal Error:",e),showToast("Error","Payment failed","error")},onCancel:()=>{showToast("Info","Payment cancelled","warning")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal",tagline:!1,height:45}}).render("#renew-paypal-button-container")}function updateCategorySelect(){const e=document.getElementById("product-category");e.innerHTML=`<option value="">${window.langConfig.getText("store.modal.selectCategory")}</option>`,categories.forEach(t=>{const o=document.createElement("option");o.value=t.id,o.textContent=t.name,e.appendChild(o)})}function openPurchaseModal(e){currentProduct=e,appliedDiscount=0;const t=document.getElementById("purchase-modal"),o=e.image||getStoreConfig("defaultProductImage","");document.getElementById("purchase-details").innerHTML=`<div class="purchase-details"><img src="${o}" alt="${e.title}" style="max-width:${getStoreConfig("ui.purchaseImageMaxWidth","250px")};max-height:${getStoreConfig("ui.purchaseImageMaxHeight","250px")};object-fit:cover;border-radius:15px;margin-bottom:20px;border:3px solid var(--primary-color);box-shadow:0 10px 30px rgba(126,105,171,0.3)"/><h4>${e.title}</h4><p>${e.description}</p>${e.role_id?`<div style="color:var(--success-color);margin:10px 0;"><i class="fas fa-user-tag"></i> You will receive Discord role upon purchase</div>`:""}${e.expiry_days?`<div style="color:var(--warning-color);margin:10px 0;"><i class="fas fa-clock"></i> Subscription duration: ${e.expiry_days} days</div>`:`<div style="color:var(--success-color);margin:10px 0;"><i class="fas fa-infinity"></i> Permanent access</div>`}<div class="purchase-price-display" id="current-price">$${e.price}</div></div>`,document.getElementById("discount-code").value="",document.getElementById("discount-info").classList.remove("active"),t.classList.add("active"),renderPayPalButton(e)}function applyDiscount(){const e=document.getElementById("discount-code").value.toUpperCase(),t=document.getElementById("discount-info");e?fetch("/api/store/discount/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:e})}).then(e=>e.json()).then(e=>{if(e.valid){appliedDiscount=e.discount;const o=currentProduct.price*(1-appliedDiscount);document.getElementById("current-price").innerHTML=`<div style="text-decoration:line-through;color:var(--gray-color);font-size:24px;">$${currentProduct.price}</div><div>$${o.toFixed(2)}</div>`,t.classList.add("active"),showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("store.purchase.discountApplied"),"success"),renderPayPalButton(currentProduct)}else showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.invalidDiscount"),"error")}).catch(()=>{showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.discountError"),"error")}):showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.enterDiscountCode"),"error")}function renderPayPalButton(e){document.getElementById("paypal-button-container").innerHTML="";const t=e.price*(1-appliedDiscount);paypal.Buttons({createOrder:(o,n)=>n.order.create({purchase_units:[{amount:{value:t.toFixed(2),currency_code:getStoreConfig("currency","USD")},description:`${e.title} - Premium Store Purchase`}]}),onApprove:(o,n)=>n.order.capture().then(o=>{fetch("/api/store/purchase",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({productId:e.id,paypalOrderId:o.id,amount:t,discountCode:appliedDiscount>0?document.getElementById("discount-code").value:null})}).then(e=>e.json()).then(e=>{e.success?(showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("store.messages.purchaseComplete"),"success"),document.getElementById("purchase-modal").classList.remove("active"),loadPurchases(),loadAdminStats()):showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.purchaseFailed"),"error")}).catch(()=>{showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("toast.unknownError"),"error")})}),onError:e=>{console.error("PayPal Error:",e),showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.paymentFailed"),"error")},onCancel:()=>{showToast(window.langConfig.getText("toast.info"),window.langConfig.getText("store.messages.paymentCancelled"),"warning")},style:{layout:"vertical",color:"gold",shape:"rect",label:"paypal",tagline:!1,height:45}}).render("#paypal-button-container")}function editProduct(e){document.getElementById("modal-title").textContent=window.langConfig.getText("store.modal.editProduct"),document.getElementById("product-category").value=e.category_id,document.getElementById("product-title").value=e.title,document.getElementById("product-description").value=e.description,document.getElementById("product-price").value=e.price,document.getElementById("product-image").value=e.image||"",document.getElementById("product-video").value=e.video||"",document.getElementById("product-download").value=e.download_link||"",document.getElementById("product-expiry").value=e.expiry_days||"",document.getElementById("product-role").value=e.role_id||"",document.getElementById("product-form").dataset.editId=e.id,document.getElementById("product-modal").classList.add("active")}function deleteProduct(e){fetch(`/api/store/products/${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{e.success?(showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("store.messages.productDeleted"),"success"),loadProducts(currentCategory),loadCategories(),loadAdminStats()):showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.deleteError"),"error")}).catch(()=>{showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("toast.unknownError"),"error")})}function checkAuthOnLoad(){const e=localStorage.getItem("ticketSystemUserId");e?fetch(`/auth/check-session?id=${e}`).then(e=>e.json()).then(e=>{e.authenticated?(currentUser=e.user,isAdmin=e.isAdmin,updateWelcomeMessage(e.user),checkStoreAdmin()):(localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/discord")}).catch(e=>{console.error("Error checking saved session:",e),localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/discord"}):window.location.href="/auth/discord",loadUserSettings()}toggleSidebarBtn.addEventListener("click",toggleSidebar),bottomToggleBtn.addEventListener("click",toggleSidebar),document.getElementById("add-product-btn").addEventListener("click",()=>{document.getElementById("modal-title").textContent=window.langConfig.getText("store.modal.addProduct"),document.getElementById("product-form").reset(),delete document.getElementById("product-form").dataset.editId,document.getElementById("product-modal").classList.add("active")}),document.getElementById("close-modal").addEventListener("click",()=>{document.getElementById("product-modal").classList.remove("active")}),document.getElementById("close-purchase-modal").addEventListener("click",()=>{document.getElementById("purchase-modal").classList.remove("active")}),document.getElementById("close-renew-modal").addEventListener("click",()=>{document.getElementById("renew-modal").classList.remove("active")}),document.getElementById("apply-discount-btn").addEventListener("click",applyDiscount),document.getElementById("apply-renew-discount-btn").addEventListener("click",applyRenewalDiscount),document.getElementById("my-purchases-btn").addEventListener("click",()=>{const e=document.getElementById("purchases-container"),t=document.getElementById("products-container"),o=document.getElementById("categories-container");"none"===e.style.display?(loadPurchases(),e.style.display="block",t.style.display="none",o.style.display="none"):(e.style.display="none",t.style.display="grid",o.style.display="grid")}),document.getElementById("all-categories-btn").addEventListener("click",()=>{currentCategory=null,document.querySelectorAll(".category-card").forEach(e=>e.classList.remove("active")),loadProducts(),document.getElementById("purchases-container").style.display="none",document.getElementById("products-container").style.display="grid",document.getElementById("categories-container").style.display="grid"}),document.getElementById("manage-categories-btn").addEventListener("click",()=>{window.location.href="/Store/Categories"}),document.getElementById("view-orders-btn").addEventListener("click",()=>{window.location.href="/Store/Analytics"}),document.getElementById("manage-discounts-btn").addEventListener("click",()=>{window.location.href="/Store/Discounts"}),document.getElementById("product-form").addEventListener("submit",e=>{e.preventDefault();const t=document.getElementById("product-form").dataset.editId,o=document.getElementById("product-category").value,n=document.getElementById("new-category").value.trim(),a={title:document.getElementById("product-title").value,description:document.getElementById("product-description").value,price:document.getElementById("product-price").value,image:document.getElementById("product-image").value,video:document.getElementById("product-video").value,downloadLink:document.getElementById("product-download").value,expiryDays:document.getElementById("product-expiry").value,roleId:document.getElementById("product-role").value};if(o)a.categoryId=o;else if(n)a.newCategory=n;else{if(0!==categories.length)return showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.selectCategoryError"),"error");if(!n)return showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("store.messages.createCategoryError"),"error")}fetch(t?`/api/store/products/${t}`:"/api/store/products",{method:t?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{e.success?(showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("store.messages.productSaved"),"success"),document.getElementById("product-modal").classList.remove("active"),loadCategories(),loadProducts(currentCategory),loadAdminStats()):showToast(window.langConfig.getText("toast.error"),e.error||window.langConfig.getText("store.messages.saveError"),"error")}).catch(()=>{showToast(window.langConfig.getText("toast.error"),window.langConfig.getText("toast.unknownError"),"error")})}),document.getElementById("logout-btn").addEventListener("click",()=>{localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/logout"}),document.addEventListener("DOMContentLoaded",function(){if(loadSidebarState()&&sidebar.classList.add("collapsed"),window.langConfig){const e=localStorage.getItem("selectedLanguage");e&&window.langConfig.setLanguage(e),window.langConfig.updateUI()}checkAuthOnLoad(),loadCategories()})</script></body></html>
