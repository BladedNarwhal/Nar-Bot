
<!doctype html><html lang=en dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Users - Community Server TovStudio</title><meta name=description content="User Management - Community Server TovStudio"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;600;700&display=swap" rel=stylesheet><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css><script src=https://cdn.socket.io/4.6.0/socket.io.min.js></script><style>:root{--primary-color:var(--system-primary-color,#7e69ab);--primary-hover:var(--system-primary-hover,#6b5b9a);--secondary-color:var(--system-secondary-color,#9b87f5);--secondary-hover:var(--system-secondary-hover,#8b77f0);--dark-color:var(--system-dark-color,#1a1f2c);--darker-color:var(--system-darker-color,#151a26);--light-color:var(--system-light-color,#f1f0fb);--text-color:var(--system-text-color,#e5deff);--text-muted:var(--system-text-muted,#b8b4d1);--success-color:var(--system-success-color,#48bb78);--warning-color:var(--system-warning-color,#f6ad55);--danger-color:var(--system-danger-color,#f56565);--gray-color:var(--system-gray-color,#a0aec0);--glass-bg:var(--system-glass-bg,rgba(26, 31, 44, 0.85));--glass-border:var(--system-glass-border,rgba(155, 135, 245, 0.3));--glass-hover:var(--system-glass-hover,rgba(155, 135, 245, 0.1));--status-open:var(--system-status-open,#48bb78);--status-closed:var(--system-status-closed,#f56565);--status-on-hold:var(--system-status-on-hold,#f6ad55);--shadow-sm:var(--system-shadow-sm,0 2px 4px rgba(0, 0, 0, 0.1));--shadow-md:var(--system-shadow-md,0 4px 6px rgba(0, 0, 0, 0.1));--shadow-lg:var(--system-shadow-lg,0 10px 15px rgba(0, 0, 0, 0.2));--border-radius:var(--system-border-radius,12px);--border-radius-sm:var(--system-border-radius-sm,8px);--border-radius-lg:var(--system-border-radius-lg,16px);--transition:var(--system-transition,all 0.3s cubic-bezier(0.4, 0, 0.2, 1));--transition-fast:var(--system-transition-fast,all 0.2s cubic-bezier(0.4, 0, 0.2, 1));--users-per-page:var(--system-users-per-page,10);--toast-duration:var(--system-toast-duration,5000);--users-grid-columns:var(--system-users-grid-columns,320px);--user-card-min-width:var(--system-user-card-min-width,320px);--sidebar-width:var(--system-sidebar-width,280px);--sidebar-collapsed-width:var(--system-sidebar-collapsed-width,80px);--backdrop-blur:var(--system-backdrop-blur,blur(20px));--modal-backdrop-blur:var(--system-modal-backdrop-blur,blur(10px));--youtube-color:var(--system-youtube-color,#ff0000);--tiktok-color:var(--system-tiktok-color,#ff0050);--store-color:var(--system-store-color,#00d4aa);--vip-color:var(--system-vip-color,#ffd700);--verification-color:var(--system-verification-color,#1da1f2)}*{margin:0;padding:0;box-sizing:border-box;font-family:Tajawal,Poppins,sans-serif}body{background:linear-gradient(135deg,var(--dark-color) 0,var(--darker-color) 100%);color:var(--text-color);min-height:100vh;overflow-x:hidden;background-size:cover;background-position:center;background-attachment:fixed}body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 20% 50%,rgba(126,105,171,.1) 0,transparent 50%),radial-gradient(circle at 80% 20%,rgba(155,135,245,.1) 0,transparent 50%),radial-gradient(circle at 40% 80%,rgba(126,105,171,.05) 0,transparent 50%);pointer-events:none;z-index:-1}.container{display:flex;min-height:100vh;position:relative}.sidebar{width:var(--sidebar-width);background:var(--glass-bg);backdrop-filter:var(--backdrop-blur);border-right:1px solid var(--glass-border);padding:0;display:flex;flex-direction:column;transition:var(--transition);z-index:100;box-shadow:var(--shadow-lg)}.sidebar.collapsed{width:var(--sidebar-collapsed-width)}.logo-container{padding:24px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--glass-border);background:linear-gradient(135deg,var(--glass-bg) 0,rgba(155,135,245,.1) 100%)}.logo{display:flex;align-items:center;transition:var(--transition)}.logo img{width:42px;height:42px;border-radius:50%;margin-right:12px;border:2px solid var(--primary-color);transition:var(--transition)}.logo img:hover{transform:scale(1.05);border-color:var(--secondary-color)}.logo-text{font-size:18px;font-weight:700;color:var(--text-color);white-space:nowrap;transition:var(--transition)}.menu-toggle{cursor:pointer;color:var(--text-color);background:0 0;border:none;font-size:20px;padding:8px;border-radius:var(--border-radius-sm);transition:var(--transition)}.menu-toggle:hover{background:var(--glass-hover);transform:scale(1.1)}.sidebar.collapsed .logo-text{opacity:0;transform:translateX(-20px)}.menu{list-style:none;padding:20px 0;margin:0;flex:1}.menu-item{padding:16px 24px;display:flex;align-items:center;cursor:pointer;color:var(--text-muted);transition:var(--transition);position:relative;margin:4px 12px;border-radius:var(--border-radius)}.menu-item::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.menu-item.active,.menu-item:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.menu-item.active::before,.menu-item:hover::before{height:24px}.menu-item i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition)}.menu-item:hover i{transform:scale(1.1)}.menu-text{font-weight:500;transition:var(--transition)}.sidebar.collapsed .menu-text{opacity:0;transform:translateX(-20px)}.sidebar-bottom-toggle{display:none;padding:16px 24px;margin:4px 12px;cursor:pointer;color:var(--text-muted);background:transparent;border:none;border-radius:var(--border-radius);transition:var(--transition);justify-content:flex-start;align-items:center;font-size:18px;position:relative}.sidebar-bottom-toggle::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:4px;height:0;background:var(--primary-color);border-radius:2px;transition:var(--transition)}.sidebar-bottom-toggle:hover{background:linear-gradient(135deg,var(--primary-color) 0,var(--secondary-color) 100%);color:#fff;transform:translateX(4px);box-shadow:var(--shadow-md)}.sidebar-bottom-toggle:hover::before{height:24px}.sidebar-bottom-toggle i{width:24px;text-align:center;margin-right:16px;font-size:18px;transition:var(--transition)}.sidebar-bottom-toggle:hover i{transform:scale(1.1)}.sidebar.collapsed .sidebar-bottom-toggle{display:flex}.sidebar.collapsed .menu-toggle{display:none}.main-content{flex:1;padding:32px;overflow-y:auto;position:relative}.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;padding:24px 32px;background:var(--glass-bg);backdrop-filter:var(--backdrop-blur);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);box-shadow:var(--shadow-md)}#welcome-message{font-size:18px;font-weight:600;color:var(--text-color);opacity:0;transform:translateY(20px);animation:fadeInUp .6s ease-out .2s forwards}.section-title{font-size:28px;font-weight:700;margin-bottom:32px;color:var(--text-color);position:relative;opacity:0;transform:translateY(20px);animation:fadeInUp .6s ease-out .4s forwards}.section-title::after{content:'';position:absolute;bottom:-8px;left:0;width:60px;height:4px;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));border-radius:2px}.users-section{margin-bottom:40px;opacity:0;transform:translateY(20px);animation:fadeInUp .6s ease-out .6s forwards}.users-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--users-grid-columns),1fr));gap:20px;margin-bottom:30px}.section-card{background:var(--glass-bg);backdrop-filter:var(--backdrop-blur);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:25px;box-shadow:var(--shadow-md);transition:var(--transition)}.section-card:hover{transform:translateY(-5px);box-shadow:var(--shadow-lg);border-color:var(--primary-color)}.section-header{display:flex;align-items:center;gap:12px;margin-bottom:20px;padding-bottom:15px;border-bottom:1px solid var(--glass-border)}.section-header h3{font-size:20px;font-weight:600;color:var(--text-color);margin:0}.section-header i{font-size:18px;color:var(--primary-color)}.search-container{margin-bottom:20px}.search-input{width:100%;padding:12px 16px;background:var(--glass-bg);border:2px solid var(--glass-border);border-radius:var(--border-radius);color:var(--text-color);font-size:14px;transition:var(--transition)}.search-input:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(126,105,171,.2)}.user-card{background:rgba(155,135,245,.05);border:1px solid var(--glass-border);border-radius:var(--border-radius);padding:18px;margin-bottom:15px;display:flex;align-items:center;gap:15px;transition:var(--transition);position:relative;overflow:hidden;min-width:var(--user-card-min-width)}.user-card::before{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(135deg,rgba(126,105,171,.1),transparent);opacity:0;transition:var(--transition)}.user-card:hover::before{opacity:1}.user-card:hover{transform:translateY(-2px);border-color:var(--primary-color);box-shadow:0 8px 25px rgba(126,105,171,.2)}.user-avatar{position:relative}.user-avatar img{width:50px;height:50px;border-radius:50%;border:3px solid var(--primary-color);box-shadow:0 0 15px rgba(126,105,171,.3);transition:var(--transition)}.user-card:hover .user-avatar img{transform:scale(1.1);box-shadow:0 0 20px rgba(126,105,171,.5)}.user-info{flex:1;min-width:0}.user-name{font-weight:600;font-size:16px;color:var(--text-color);margin-bottom:5px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:flex;align-items:center;gap:8px}.user-name .role-icon{width:20px;height:20px;border-radius:50%;object-fit:cover}.user-name .verification-icon{width:16px;height:16px;margin-left:4px}.user-status{font-size:12px;color:var(--text-muted);display:flex;align-items:center;gap:5px}.status-indicator{width:8px;height:8px;border-radius:50%;background:var(--success-color);animation:pulse 2s infinite}@keyframes pulse{0%{opacity:1}50%{opacity:.5}100%{opacity:1}}.user-actions{display:flex;gap:8px;margin-right:10px;z-index:10;position:relative}.user-action-btn{background:0 0;border:2px solid var(--danger-color);cursor:pointer;padding:8px 12px;border-radius:var(--border-radius-sm);transition:var(--transition);color:var(--danger-color);font-size:14px;font-weight:600;min-width:44px;height:40px;display:flex;align-items:center;justify-content:center;pointer-events:auto}.user-action-btn:not(:disabled):hover{background:var(--danger-color);color:#fff;transform:scale(1.05);box-shadow:0 4px 15px rgba(245,101,101,.3)}.user-action-btn:disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.badge{padding:6px 12px;border-radius:20px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;white-space:nowrap}.admin-badge{background:linear-gradient(135deg,var(--warning-color),#ff9500);color:#fff;box-shadow:0 2px 10px rgba(246,173,85,.3)}.banned-badge{background:linear-gradient(135deg,var(--danger-color),#e53e3e);color:#fff;box-shadow:0 2px 10px rgba(245,101,101,.3)}.points-badge{background:linear-gradient(135deg,var(--secondary-color),var(--primary-color));color:#fff;box-shadow:0 2px 10px rgba(155,135,245,.3)}.youtube-role{color:var(--youtube-color)!important}.tiktok-role{color:var(--tiktok-color)!important}.store-role{color:var(--store-color)!important}.vip-role{color:var(--vip-color)!important}.verified-role{color:var(--verification-color)!important}.ban-reason{font-size:11px;color:var(--gray-color);margin-top:8px;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:4px 8px;background:rgba(160,174,192,.1);border-radius:var(--border-radius-sm)}.load-more-btn{display:block;width:100%;margin:20px auto 0;padding:12px 24px;background:var(--glass-bg);border:2px solid var(--primary-color);color:var(--primary-color);border-radius:var(--border-radius);font-weight:600;cursor:pointer;transition:var(--transition);text-align:center}.load-more-btn:hover{background:var(--primary-color);color:#fff;transform:translateY(-2px);box-shadow:0 4px 15px rgba(126,105,171,.3)}.load-more-btn:disabled{opacity:.5;cursor:not-allowed;pointer-events:none}.btn{padding:12px 24px;border-radius:var(--border-radius);border:none;font-weight:600;cursor:pointer;transition:var(--transition);display:inline-flex;align-items:center;gap:8px;text-decoration:none;font-size:14px;position:relative;overflow:hidden;pointer-events:auto;box-shadow:var(--shadow-sm)}.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);transition:var(--transition)}.btn:hover::before{left:100%}.btn-primary{background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff}.btn-primary:hover{transform:translateY(-2px);box-shadow:var(--shadow-lg)}.btn-secondary{background:var(--glass-bg);color:var(--text-color);border:1px solid var(--primary-color)}.btn-secondary:hover{background:var(--primary-color);transform:translateY(-2px);box-shadow:var(--shadow-md)}.btn-sm{padding:8px 16px;font-size:12px;height:36px;min-height:36px}.unban-btn{background:0 0!important;border:2px solid var(--success-color)!important;color:var(--success-color)!important;pointer-events:auto!important;cursor:pointer!important;position:relative;z-index:10}.unban-btn:hover{background:var(--success-color)!important;color:#fff!important;transform:translateY(-2px);box-shadow:0 4px 15px rgba(72,187,120,.3)}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);backdrop-filter:var(--modal-backdrop-blur);display:none;justify-content:center;align-items:center;z-index:1000;animation:fadeIn .3s ease}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.modal-content{background:var(--glass-bg);backdrop-filter:var(--backdrop-blur);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:30px;width:90%;max-width:450px;position:relative;box-shadow:var(--shadow-lg);animation:slideIn .3s ease}@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px;padding-bottom:15px;border-bottom:1px solid var(--glass-border)}.modal-title{font-size:20px;font-weight:700;color:var(--text-color)}.modal-close{background:0 0;border:none;color:var(--gray-color);font-size:24px;cursor:pointer;padding:5px;border-radius:50%;transition:var(--transition)}.modal-close:hover{background:var(--danger-color);color:#fff;transform:rotate(90deg)}.form-group{margin-bottom:20px}.form-label{display:block;margin-bottom:8px;font-weight:600;color:var(--text-color);font-size:14px}.form-control{width:100%;padding:12px 15px;border:2px solid var(--glass-border);border-radius:var(--border-radius);background:rgba(26,31,44,.8);color:var(--text-color);font-size:14px;transition:var(--transition);resize:vertical}.form-control:focus{outline:0;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(126,105,171,.2)}.modal-actions{display:flex;justify-content:flex-end;gap:15px;margin-top:25px}#toast-container{position:fixed;top:24px;right:24px;z-index:2000}.toast{display:flex;align-items:center;background:var(--glass-bg);backdrop-filter:var(--backdrop-blur);border:1px solid var(--glass-border);border-radius:var(--border-radius-lg);padding:16px 24px;margin-bottom:12px;min-width:320px;max-width:480px;box-shadow:var(--shadow-lg);opacity:0;transform:translateX(100%);animation:slideInRight .4s ease-out forwards}.toast.removing{animation:slideOutRight .4s ease-out forwards}.toast-icon{font-size:20px;margin-right:16px;flex-shrink:0}.toast-content{flex:1}.toast-title{font-weight:600;font-size:15px;margin-bottom:4px}.toast-message{font-size:14px;color:var(--text-muted);line-height:1.4}.toast-close{background:0 0;border:none;color:var(--gray-color);font-size:18px;cursor:pointer;padding:4px;border-radius:4px;transition:var(--transition);margin-left:12px}.toast-close:hover{color:var(--text-color);background:var(--glass-hover)}.empty-state{text-align:center;padding:60px 24px;color:var(--text-muted)}.empty-state i{font-size:64px;margin-bottom:24px;color:var(--gray-color);opacity:.5}.empty-state h3{font-size:24px;margin-bottom:12px;color:var(--text-color)}.empty-state p{font-size:16px;line-height:1.6}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes slideInRight{from{opacity:0;transform:translateX(100%)}to{opacity:1;transform:translateX(0)}}@keyframes slideOutRight{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}@media (max-width:1024px){.main-content{padding:24px}.header{padding:20px 24px}}@media (max-width:768px){.container{flex-direction:column}.sidebar{width:100%;border-right:none;border-bottom:1px solid var(--glass-border);position:relative}.sidebar.collapsed{width:100%}.main-content{padding:16px}.header{flex-direction:column;gap:16px;padding:16px}.users-grid{grid-template-columns:1fr}.section-title{font-size:24px}.user-card{flex-direction:column;text-align:center;gap:10px}.user-actions{margin-right:0}.modal-content{margin:20px;width:calc(100% - 40px)}.toast{min-width:280px;margin:0 16px 12px 16px}}@media (max-width:480px){.main-content{padding:15px 10px}}.loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(155,135,245,.3);border-radius:50%;border-top-color:var(--primary-color);animation:spin 1s ease-in-out infinite}@keyframes spin{to{transform:rotate(360deg)}}</style><script src=https://cdn.gpteng.co/gptengineer.js type=module></script><script src=lang-config.js></script><script src=system-config.js></script></head><body><div class=container><div class=sidebar><div class=logo-container><div class=logo><img src="" id=logo-img alt=Logo><div class=logo-text data-lang-key=sidebar.title>Community Server TovStudio</div></div><button class=menu-toggle id=toggle-sidebar><i class="fas fa-bars"></i></button></div><ul class=menu><li class=menu-item onclick='window.location.href="/Home"'><i class="fas fa-home"></i><span class=menu-text>Home</span></li><li class=menu-item onclick='window.location.href="/"'><i class="fas fa-chart-bar"></i><span class=menu-text data-lang-key=sidebar.dashboard>Dashboard</span></li><li class=menu-item onclick='window.location.href="/Tickets"'><i class="fas fa-ticket"></i><span class=menu-text data-lang-key=sidebar.tickets>Tickets</span></li><li class="menu-item active" onclick='window.location.href="/Users"'><i class="fas fa-users"></i><span class=menu-text data-lang-key=sidebar.users>Users</span></li><li class=menu-item onclick='window.location.href="/Ratings"'><i class="fas fa-star"></i><span class=menu-text data-lang-key=sidebar.ratings>Ratings</span></li><li class=menu-item onclick='window.location.href="/Store"'><i class="fas fa-store"></i><span class=menu-text data-lang-key=sidebar.store>Store</span></li><li class=menu-item onclick='window.location.href="/Settings"'><i class="fas fa-cog"></i><span class=menu-text data-lang-key=sidebar.settings>Settings</span></li><li class=menu-item id=logout-btn><i class="fas fa-sign-out-alt"></i><span class=menu-text data-lang-key=sidebar.logout>Logout</span></li><li class=menu-item id=sidebar-bottom-toggle style=display:none><i class="fas fa-bars"></i><span class=menu-text>Toggle Menu</span></li></ul><button class="sidebar-bottom-toggle" id="bottom-toggle-sidebar"><i class="fas fa-bars"></i></button></div><div class=main-content><div class=header><div id=welcome-message></div><button class="btn btn-primary" id=login-btn><i class="fas fa-sign-in-alt"></i> <span data-lang-key=header.login>Login</span></button></div><h2 class=section-title data-lang-key=users.title><i class="fas fa-users-cog"></i> Users Management</h2><div class=users-section><div class=section-card><div class=section-header><i class="fas fa-user-shield"></i><h3 data-lang-key=users.activeAdmins>Active Admins</h3></div><div class=search-container><input type=text id=admin-search class=search-input placeholder="Search admins..."></div><div id=all-admins></div><button id=load-more-admins class=load-more-btn style=display:none><i class="fas fa-plus"></i> Load More</button></div><div class=section-card><div class=section-header><i class="fas fa-user-check"></i><h3 data-lang-key=users.activeUsers>Active Users</h3></div><div class=search-container><input type=text id=active-user-search class=search-input placeholder="Search active users..."></div><div id=active-users></div><button id=load-more-active class=load-more-btn style=display:none><i class="fas fa-plus"></i> Load More</button></div><div class=section-card><div class=section-header><i class="fas fa-users"></i><h3 data-lang-key=users.allUsers>All Users</h3></div><div class=search-container><input type=text id=user-search class=search-input placeholder="Search users by name..."></div><div id=all-users></div><button id=load-more-users class=load-more-btn style=display:none><i class="fas fa-plus"></i> Load More</button></div><div class=section-card><div class=section-header><i class="fas fa-user-slash"></i><h3 data-lang-key=users.bannedUsers>Banned Users</h3></div><div id=all-banned></div></div></div></div></div><div id=ban-modal class=modal><div class=modal-content><div class=modal-header><div class=modal-title data-lang-key=modals.ban.title><i class="fas fa-ban"></i> Ban User</div><button class=modal-close id=ban-modal-close>&times;</button></div><div class=form-group><label class=form-label data-lang-key=modals.ban.reason>Ban Reason</label><textarea id=ban-reason class=form-control rows=4 data-lang-placeholder=modals.ban.reasonPlaceholder></textarea></div><div class=modal-actions><button class="btn btn-secondary" id=ban-cancel data-lang-key=modals.ban.cancel><i class="fas fa-times"></i> Cancel</button><button class="btn btn-primary" id=ban-submit data-lang-key=modals.ban.ban><i class="fas fa-ban"></i> Ban User</button></div></div></div><div id=toast-container></div><audio id=notification-sound src=https://files.catbox.moe/wzac7y.mp3></audio><script>const sidebar=document.querySelector(".sidebar"),toggleSidebarBtn=document.getElementById("toggle-sidebar"),bottomToggleBtn=document.getElementById("bottom-toggle-sidebar"),loginBtn=document.getElementById("login-btn"),logoutBtn=document.getElementById("logout-btn"),banModal=document.getElementById("ban-modal"),banModalCloseBtn=document.getElementById("ban-modal-close"),banCancelBtn=document.getElementById("ban-cancel"),banSubmitBtn=document.getElementById("ban-submit"),userSearchInput=document.getElementById("user-search"),activeUserSearchInput=document.getElementById("active-user-search"),adminSearchInput=document.getElementById("admin-search"),loadMoreBtn=document.getElementById("load-more-users"),loadMoreActiveBtn=document.getElementById("load-more-active"),loadMoreAdminsBtn=document.getElementById("load-more-admins");let currentUser=null,isAdmin=!1,settings={},allUsersData=[],filteredUsersData=[],activeUsersData=[],filteredActiveUsersData=[],activeAdminsData=[],filteredAdminsData=[],currentDisplayedUsers=0,currentDisplayedActiveUsers=0,currentDisplayedAdmins=0,usersPerLoad=10,isLoadingUsers=!1,isLoadingActiveUsers=!1,isLoadingAdmins=!1,toastDuration=window.systemConfig?.users?.toastDuration||5000;const socket=io(),roleConfig={YOUTUBE_ROLE_ID:null,YOUTUBE_BADGE_URL:null,YOUTUBE_COLOR:"#ff0000",TIKTOK_ROLE_ID:null,TIKTOK_BADGE_URL:null,TIKTOK_COLOR:"#ff0050",ServerBooster_ROLE_ID:null,STORE_BADGE_URL:null,STORE_COLOR:"#00d4aa",VIP_ROLE_ID:null,VIP_BADGE_URL:null,VIP_COLOR:"#ffd700",VERIFICATION_ROLE_ID:null,VERIFICATION_BADGE_URL:null,VERIFICATION_COLOR:"#1da1f2"};function loadSidebarState(){const e=localStorage.getItem("sidebarCollapsed");return"true"===e}function saveSidebarState(e){localStorage.setItem("sidebarCollapsed",e.toString())}function toggleSidebar(){sidebar.classList.toggle("collapsed");const e=sidebar.classList.contains("collapsed");saveSidebarState(e)}function loadEnvConfig(){const e=document.querySelector('meta[name="env-config"]')?.content;if(e)try{const n=JSON.parse(e);Object.assign(roleConfig,n)}catch(t){console.warn("Failed to parse env config:",t)}}function loadUserSettings(){try{const e=localStorage.getItem("userSettings");if(e)return settings=JSON.parse(e),void applySettings();fetch("/api/settings").then(e=>e.json()).then(e=>{settings=e,applySettings(),localStorage.setItem("userSettings",JSON.stringify(settings))}).catch(e=>{console.error("Error loading settings:",e)})}catch(e){console.error("Error loading settings:",e)}}function checkSavedSession(e){fetch(`/auth/check-session?id=${e}`).then(e=>e.json()).then(e=>{e.authenticated?handleSuccessfulLogin(e.user,e.isAdmin):(localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/discord")}).catch(e=>{console.error("Error checking saved session:",e),localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/discord"})}function checkAuthStatus(){fetch("/api/auth/status").then(e=>e.json()).then(e=>{e.authenticated?handleSuccessfulLogin(e.user,e.isAdmin):e.banned?(showToast(window.langConfig.getText("toast.banned"),window.langConfig.getText("toast.bannedMessage"),"error"),setTimeout(()=>{window.location.href="/auth/logout"},3e3)):window.location.href="/auth/discord"}).catch(e=>{console.error("Error checking auth status:",e),window.location.href="/auth/discord"})}function handleSuccessfulLogin(e,n){currentUser=e,isAdmin=n,localStorage.setItem("ticketSystemUserId",e.id),document.getElementById("welcome-message").innerHTML=`\n          <div style="display: flex; align-items: center; gap: 10px;">\n            <img src="${e.avatar?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:"https://cdn.discordapp.com/embed/avatars/0.png"}" \n                 style="width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--primary-color);" \n                 alt="${e.global_name||e.username}">\n            <span>${window.langConfig.getText("header.welcome")} ${e.global_name||e.username}</span>\n          </div>\n        `,loginBtn.style.display="none",loadAdmins(),loadActiveUsers(),loadAllUsers(),loadBannedUsers()}function applySettings(){settings.background&&(document.body.style.backgroundImage=`url('${settings.background}')`),settings.logo&&(document.getElementById("logo-img").src=settings.logo)}function showLoading(e){document.getElementById(e).innerHTML='\n          <div class="empty-state">\n            <div class="loading"></div>\n            <p>Loading...</p>\n          </div>\n        '}function showEmptyState(e,n,t,s){document.getElementById(e).innerHTML=`\n          <div class="empty-state">\n            <i class="fas ${n}"></i>\n            <h3>${t}</h3>\n            <p>${s}</p>\n          </div>\n        `}function createRoleIcons(e){let n="";return e.verified&&(n+=`<img src="${roleConfig.VERIFICATION_BADGE_URL||"https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Twitter_Verified_Badge.svg/2048px-Twitter_Verified_Badge.svg.png"}" class="verification-icon" title="Verified" alt="Verified">`),e.youtube&&(n+=`<img src="${roleConfig.YOUTUBE_BADGE_URL||"https://media3.giphy.com/media/lMafmoY1FNsX1GkBT2/giphy.webp?cid=ecf05e4782uu7kldfaeano9hsi5zbnw7f8iampslt1g17i7q&ep=v1_stickers_search&rid=giphy.webp&ct=s"}" class="role-icon" title="YouTube" alt="YouTube">`),e.tiktok&&(n+=`<img src="${roleConfig.TIKTOK_BADGE_URL||"https://i.giphy.com/YrTn91UVNh4Oc01rUR.webp"}" class="role-icon" title="TikTok" alt="TikTok">`),e.store&&(n+=`<img src="${roleConfig.STORE_BADGE_URL||"https://cdn3.emoji.gg/emojis/9836-flying-nitro-boost.gif"}" class="role-icon" title="Store" alt="Store">`),e.vip&&(n+=`<img src="${roleConfig.VIP_BADGE_URL||"https://i.giphy.com/dDcIt4Ftnjq5P8EaEC.webp"}" class="role-icon" title="VIP" alt="VIP">`),n}function getUserNameColor(e){return e.youtube?roleConfig.YOUTUBE_COLOR:e.tiktok?roleConfig.TIKTOK_COLOR:e.store?roleConfig.STORE_COLOR:e.vip?roleConfig.VIP_COLOR:e.verified?roleConfig.VERIFICATION_COLOR:"var(--text-color)"}function loadAdmins(){isLoadingAdmins=!0,showLoading("all-admins"),fetch("/api/admins/active").then(e=>e.json()).then(e=>{activeAdminsData=e,filteredAdminsData=e,currentDisplayedAdmins=0,displayAdmins(),adminSearchInput.value="",loadActiveUsers()}).catch(e=>{console.error("Error loading admins:",e),showEmptyState("all-admins","fa-exclamation-triangle","Error","Failed to load administrators")}).finally(()=>{isLoadingAdmins=!1})}function displayAdmins(){const e=document.getElementById("all-admins");if(0===filteredAdminsData.length)return showEmptyState("all-admins","fa-user-shield",window.langConfig.getText("users.noAdmins"),"No administrators found"),void(loadMoreAdminsBtn.style.display="none");const n=currentDisplayedAdmins+usersPerLoad,t=filteredAdminsData.slice(currentDisplayedAdmins,n);0===currentDisplayedAdmins&&(e.innerHTML=""),t.forEach(n=>{e.innerHTML+=createUserCard(n,"admin")}),currentDisplayedAdmins=n,loadMoreAdminsBtn.style.display=currentDisplayedAdmins<filteredAdminsData.length?"block":"none",attachUserActionListeners()}function searchAdmins(e){const n=e.toLowerCase();filteredAdminsData=activeAdminsData.filter(e=>{const t=(e.global_name||"").toLowerCase(),s=(e.username||"").toLowerCase();return t.includes(n)||s.includes(n)}),currentDisplayedAdmins=0,displayAdmins()}function loadActiveUsers(){if(!activeAdminsData.length)return;isLoadingActiveUsers=!0,showLoading("active-users"),fetch("/api/users/active").then(e=>e.json()).then(e=>{const n=activeAdminsData.map(e=>e.id);activeUsersData=e.filter(e=>!n.includes(e.id)),filteredActiveUsersData=activeUsersData,currentDisplayedActiveUsers=0,displayActiveUsers(),activeUserSearchInput.value=""}).catch(e=>{console.error("Error loading active users:",e),showEmptyState("active-users","fa-exclamation-triangle","Error","Failed to load active users")}).finally(()=>{isLoadingActiveUsers=!1})}function displayActiveUsers(){const e=document.getElementById("active-users");if(0===filteredActiveUsersData.length)return showEmptyState("active-users","fa-user-clock",window.langConfig.getText("users.noActiveUsers"),"No users are currently online"),void(loadMoreActiveBtn.style.display="none");const n=currentDisplayedActiveUsers+usersPerLoad,t=filteredActiveUsersData.slice(currentDisplayedActiveUsers,n);0===currentDisplayedActiveUsers&&(e.innerHTML=""),t.forEach(n=>{e.innerHTML+=createUserCard(n,"active")}),currentDisplayedActiveUsers=n,loadMoreActiveBtn.style.display=currentDisplayedActiveUsers<filteredActiveUsersData.length?"block":"none",attachUserActionListeners()}function searchActiveUsers(e){const n=e.toLowerCase();filteredActiveUsersData=activeUsersData.filter(e=>{const t=(e.global_name||"").toLowerCase(),s=(e.username||"").toLowerCase();return t.includes(n)||s.includes(n)}),currentDisplayedActiveUsers=0,displayActiveUsers()}function loadAllUsers(){isLoadingUsers=!0,showLoading("all-users"),fetch("/api/users/all").then(e=>e.json()).then(e=>{allUsersData=e,filteredUsersData=e,currentDisplayedUsers=0,displayUsers(),userSearchInput.value=""}).catch(e=>{console.error("Error loading all users:",e),showEmptyState("all-users","fa-exclamation-triangle","Error","Failed to load users")}).finally(()=>{isLoadingUsers=!1})}function displayUsers(){const e=document.getElementById("all-users");if(0===filteredUsersData.length)return showEmptyState("all-users","fa-users",window.langConfig.getText("users.noUsers"),"No users found"),void(loadMoreBtn.style.display="none");const n=currentDisplayedUsers+usersPerLoad,t=filteredUsersData.slice(currentDisplayedUsers,n);0===currentDisplayedUsers&&(e.innerHTML=""),t.forEach(n=>{e.innerHTML+=createUserCard(n,"all")}),currentDisplayedUsers=n,loadMoreBtn.style.display=currentDisplayedUsers<filteredUsersData.length?"block":"none",attachUserActionListeners()}function searchUsers(e){const n=e.toLowerCase();filteredUsersData=allUsersData.filter(e=>{const t=(e.global_name||"").toLowerCase(),s=(e.username||"").toLowerCase();return t.includes(n)||s.includes(n)}),currentDisplayedUsers=0,displayUsers()}function loadBannedUsers(){showLoading("all-banned"),fetch("/api/banned").then(e=>{if(!e.ok){if(403===e.status)throw Error("Access denied");throw Error("Failed to load banned users")}return e.json()}).then(e=>{const n=document.getElementById("all-banned");0!==e.length?(n.innerHTML="",e.forEach(e=>{n.innerHTML+=createBannedUserCard(e)}),attachUnbanListeners()):showEmptyState("all-banned","fa-user-check",window.langConfig.getText("users.noBanned"),"No banned users found")}).catch(e=>{console.error("Error loading banned users:",e),showEmptyState("all-banned","fa-exclamation-triangle","Error",e.message||"Failed to load banned users")})}function createUserCard(e,n){const t=e.id===currentUser?.id,s=isAdmin&&!t,a="admin"===n,r=e.roles||{},o=createRoleIcons(r),l=getUserNameColor(r);return`\n          <div class="user-card" data-user-id="${e.id}">\n            <div class="user-avatar">\n              <img src="${e.avatar?`https://cdn.discordapp.com/avatars/${e.id}/${e.avatar}.png`:"https://cdn.discordapp.com/embed/avatars/0.png"}" \n                   alt="${e.global_name||e.username}">\n            </div>\n            <div class="user-info">\n              <div class="user-name" style="color: ${l};">\n                ${e.global_name||e.username}\n                ${o}\n              </div>\n              ${"active"===n?'<div class="user-status"><div class="status-indicator"></div>Online</div>':""}\n            </div>\n            ${s?`\n            <div class="user-actions">\n              <button class="user-action-btn ban-user-btn" data-user-id="${e.id}" title="${window.langConfig.getText("users.banUser")}">\n                <i class="fas fa-ban"></i>\n              </button>\n            </div>\n            `:""}\n            <div style="display: flex; flex-direction: column; gap: 5px; align-items: flex-end;">\n              ${a?`<div class="badge admin-badge">${window.langConfig.getText("users.adminBadge")}</div>`:""}\n              <div class="badge points-badge">${e.points||0} ${window.langConfig.getText("users.points")}</div>\n            </div>\n          </div>\n        `}function createBannedUserCard(e){return`\n          <div class="user-card" data-user-id="${e.userId}">\n            <div class="user-avatar">\n              <img src="${e.avatar?`https://cdn.discordapp.com/avatars/${e.userId}/${e.avatar}.png`:"https://cdn.discordapp.com/embed/avatars/0.png"}" \n                   alt="${e.username}">\n            </div>\n            <div class="user-info">\n              <div class="user-name">${e.username}</div>\n              <div class="ban-reason" title="${e.reason}">${e.reason}</div>\n            </div>\n            <div style="display: flex; flex-direction: column; gap: 8px; align-items: flex-end;">\n              <div class="badge banned-badge">${window.langConfig.getText("users.bannedBadge")}</div>\n              ${isAdmin?`\n              <button class="btn btn-secondary btn-sm unban-btn" data-user-id="${e.userId}">\n                <i class="fas fa-user-check"></i>\n                ${window.langConfig.getText("users.unban")}\n              </button>\n              `:""}\n            </div>\n          </div>\n        `}function attachUserActionListeners(){isAdmin&&document.querySelectorAll(".ban-user-btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),openBanModal(this.getAttribute("data-user-id"))})})}function attachUnbanListeners(){isAdmin&&document.querySelectorAll(".unban-btn").forEach(e=>{e.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),unbanUser(this.getAttribute("data-user-id"))})})}function openBanModal(e){document.getElementById("ban-reason").value="",banSubmitBtn.setAttribute("data-user-id",e),banModal.style.display="flex",document.getElementById("ban-reason").focus()}function banUser(e,n){if(!n.trim())return void showToast("Error","Ban reason is required","error");const t=banSubmitBtn,s=t.innerHTML;t.innerHTML='<div class="loading"></div> Banning...',t.disabled=!0,fetch(`/api/users/${e}/ban`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:n.trim()})}).then(e=>e.ok?e.json():e.json().then(e=>{throw e})).then(e=>{e.success&&(showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("toast.userBanned"),"success"),banModal.style.display="none")}).catch(e=>{console.error("Error banning user:",e),showToast(window.langConfig.getText("toast.error"),e.message||"Error banning user","error")}).finally(()=>{t.innerHTML=s,t.disabled=!1})}function unbanUser(e){fetch(`/api/users/${e}/unban`,{method:"POST",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json():e.json().then(e=>{throw e})).then(e=>{e.success&&showToast(window.langConfig.getText("toast.success"),window.langConfig.getText("toast.userUnbanned"),"success")}).catch(e=>{console.error("Error unbanning user:",e),showToast(window.langConfig.getText("toast.error"),e.message||"Error unbanning user","error")})}function showToast(e,n,t="info"){const s=document.getElementById("toast-container"),a=document.createElement("div");a.className="toast";let r="fa-info-circle";switch(t){case"success":r="fa-check-circle";break;case"error":r="fa-exclamation-circle";break;case"warning":r="fa-exclamation-triangle"}a.innerHTML=`\n          <i class="fas ${r} toast-icon"></i>\n          <div class="toast-content">\n            <div class="toast-title">${e}</div>\n            <div class="toast-message">${n}</div>\n          </div>\n          <button class="toast-close">&times;</button>\n        `,s.appendChild(a);const o=()=>{a.classList.add("removing"),setTimeout(()=>{a.parentNode&&a.remove()},400)};setTimeout(o,toastDuration),a.querySelector(".toast-close").addEventListener("click",o)}function checkAuthOnLoad(){const e=localStorage.getItem("ticketSystemUserId");e?checkSavedSession(e):window.location.href="/auth/discord",loadUserSettings()}loadEnvConfig(),loginBtn.addEventListener("click",()=>{window.location.href="/auth/discord"}),logoutBtn.addEventListener("click",()=>{localStorage.removeItem("ticketSystemUserId"),window.location.href="/auth/logout"}),toggleSidebarBtn.addEventListener("click",toggleSidebar),bottomToggleBtn.addEventListener("click",toggleSidebar),banModalCloseBtn.addEventListener("click",()=>{banModal.style.display="none"}),banCancelBtn.addEventListener("click",()=>{banModal.style.display="none"}),banSubmitBtn.addEventListener("click",function(){const e=this.getAttribute("data-user-id"),n=document.getElementById("ban-reason").value;banUser(e,n)}),banModal.addEventListener("click",e=>{e.target===banModal&&(banModal.style.display="none")}),userSearchInput.addEventListener("input",e=>{searchUsers(e.target.value)}),activeUserSearchInput.addEventListener("input",e=>{searchActiveUsers(e.target.value)}),adminSearchInput.addEventListener("input",e=>{searchAdmins(e.target.value)}),loadMoreBtn.addEventListener("click",()=>{isLoadingUsers||(loadMoreBtn.innerHTML='<div class="loading"></div> Loading...',loadMoreBtn.disabled=!0,setTimeout(()=>{displayUsers(),loadMoreBtn.innerHTML='<i class="fas fa-plus"></i> Load More',loadMoreBtn.disabled=!1},500))}),loadMoreActiveBtn.addEventListener("click",()=>{isLoadingActiveUsers||(loadMoreActiveBtn.innerHTML='<div class="loading"></div> Loading...',loadMoreActiveBtn.disabled=!0,setTimeout(()=>{displayActiveUsers(),loadMoreActiveBtn.innerHTML='<i class="fas fa-plus"></i> Load More',loadMoreActiveBtn.disabled=!1},500))}),loadMoreAdminsBtn.addEventListener("click",()=>{isLoadingAdmins||(loadMoreAdminsBtn.innerHTML='<div class="loading"></div> Loading...',loadMoreAdminsBtn.disabled=!0,setTimeout(()=>{displayAdmins(),loadMoreAdminsBtn.innerHTML='<i class="fas fa-plus"></i> Load More',loadMoreAdminsBtn.disabled=!1},500))}),socket.on("active_users_update",()=>{loadActiveUsers(),loadAllUsers()}),socket.on("user_connected",()=>{loadActiveUsers(),loadAllUsers()}),socket.on("user_disconnected",()=>{loadActiveUsers(),loadAllUsers()}),socket.on("user_banned",()=>{loadBannedUsers(),loadActiveUsers(),loadAllUsers()}),socket.on("user_unbanned",()=>{loadBannedUsers(),loadActiveUsers(),loadAllUsers()}),document.addEventListener("DOMContentLoaded",function(){loadSidebarState()&&sidebar.classList.add("collapsed"),window.langConfig&&(localStorage.getItem("selectedLanguage")&&window.langConfig.setLanguage(localStorage.getItem("selectedLanguage")),window.langConfig.updateUI()),checkAuthOnLoad()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&"flex"===banModal.style.display&&(banModal.style.display="none"),e.ctrlKey&&"b"===e.key&&(e.preventDefault(),sidebar.classList.toggle("collapsed"))})</script></body></html>
